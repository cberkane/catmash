import{$ as Pl,$a as xl,A as ni,B as Zs,C as ri,D as bl,H as Sl,I as eo,N as Cl,P as to,Q as ii,R as ce,T as be,V as ve,W as se,X as lt,_ as Rl,_a as so,a as Wn,aa as Xt,b as Ks,c as D,ca as Nl,da as kl,f as ct,ia as Kn,ja as Ol,k as Al,ka as Fl,l as Dl,la as Qe,n as Hs,na as no,o as Qs,p as Ys,q as Js,r as Xs,ra as Hn,s as ti,v as De,wa as ro,ya as io}from"./chunk-CKQT6GPN.js";var Bl=null;function oo(){return Bl}function QE(n){Bl??=n}var Ll=class{};var ai=new be(""),$l=(()=>{class n{historyGo(t){throw new Error("")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>se(Np),providedIn:"platform"})}}return n})();var Np=(()=>{class n extends $l{constructor(){super(),this._doc=se(ai),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return oo().getBaseHref(this._doc)}onPopState(t){let r=oo().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){let r=oo().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,i){this._history.pushState(t,r,i)}replaceState(t,r,i){this._history.replaceState(t,r,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>new n,providedIn:"platform"})}}return n})();function jl(n,e){if(n.length==0)return e;if(e.length==0)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,t==2?n+e.substring(1):t==1?n+e:n+"/"+e}function Ml(n){let e=n.match(/#|\?|$/),t=e&&e.index||n.length,r=t-(n[t-1]==="/"?1:0);return n.slice(0,r)+n.slice(t)}function Ct(n){return n&&n[0]!=="?"?"?"+n:n}var uo=(()=>{class n{historyGo(t){throw new Error("")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>se(Op),providedIn:"root"})}}return n})(),kp=new be(""),Op=(()=>{class n extends uo{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??se(ai).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return jl(this._baseHref,t)}path(t=!1){let r=this._platformLocation.pathname+Ct(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,o){let a=this.prepareExternalUrl(i+Ct(o));this._platformLocation.pushState(t,r,a)}replaceState(t,r,i,o){let a=this.prepareExternalUrl(i+Ct(o));this._platformLocation.replaceState(t,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(r){return new(r||n)(ve($l),ve(kp,8))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Fp=(()=>{class n{constructor(t){this._subject=new Fl,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;let r=this._locationStrategy.getBaseHref();this._basePath=Mp(Ml(Vl(r))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Ct(r))}normalize(t){return n.stripTrailingSlash(Lp(this._basePath,Vl(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._locationStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ct(r)),i)}replaceState(t,r="",i=null){this._locationStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ct(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r,complete:i})}static{this.normalizeQueryParams=Ct}static{this.joinWithSlash=jl}static{this.stripTrailingSlash=Ml}static{this.\u0275fac=function(r){return new(r||n)(ve(uo))}}static{this.\u0275prov=ce({token:n,factory:()=>xp(),providedIn:"root"})}}return n})();function xp(){return new Fp(ve(uo))}function Lp(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function Vl(n){return n.replace(/\/index.html$/,"")}function Mp(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}function zl(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let r=t.indexOf("="),[i,o]=r==-1?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(o)}return null}var ao=/\s+/,Ul=[],YE=(()=>{class n{constructor(t,r){this._ngEl=t,this._renderer=r,this.initialClasses=Ul,this.stateMap=new Map}set klass(t){this.initialClasses=t!=null?t.trim().split(ao):Ul}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(ao):t}ngDoCheck(){for(let r of this.initialClasses)this._updateState(r,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let r of t)this._updateState(r,!0);else if(t!=null)for(let r of Object.keys(t))this._updateState(r,!!t[r]);this._applyStateDiff()}_updateState(t,r){let i=this.stateMap.get(t);i!==void 0?(i.enabled!==r&&(i.changed=!0,i.enabled=r),i.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let r=t[0],i=t[1];i.changed?(this._toggleClass(r,i.enabled),i.changed=!1):i.touched||(i.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),i.touched=!1}}_toggleClass(t,r){t=t.trim(),t.length>0&&t.split(ao).forEach(i=>{r?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}static{this.\u0275fac=function(r){return new(r||n)(ro(no),ro(io))}}static{this.\u0275dir=Rl({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0})}}return n})();function Vp(n,e){return new ii(2100,!1)}var JE=(()=>{class n{transform(t,r,i){if(t==null)return null;if(!this.supports(t))throw Vp(n,t);return t.slice(r,i)}supports(t){return typeof t=="string"||Array.isArray(t)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275pipe=Pl({name:"slice",type:n,pure:!1,standalone:!0})}}return n})();var XE="browser",Up="server";function Bp(n){return n===Up}var si=class{};var Yn=class{},ci=class{},Ye=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let r=t.indexOf(":");if(r>0){let i=t.slice(0,r),o=i.toLowerCase(),a=t.slice(r+1).trim();this.maybeSetNormalizedName(i,o),this.headers.has(o)?this.headers.get(o).push(a):this.headers.set(o,[a])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":let o=e.value;if(!o)this.headers.delete(t),this.normalizedNames.delete(t);else{let a=this.headers.get(t);if(!a)return;a=a.filter(c=>o.indexOf(c)===-1),a.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,a)}break}}setHeaderEntries(e,t){let r=(Array.isArray(t)?t:[t]).map(o=>o.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var lo=class{encodeKey(e){return ql(e)}encodeValue(e){return ql(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function jp(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{let o=i.indexOf("="),[a,c]=o==-1?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,o)),e.decodeValue(i.slice(o+1))],h=t.get(a)||[];h.push(c),t.set(a,h)}),t}var zp=/%(\d[a-f0-9])/gi,qp={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function ql(n){return encodeURIComponent(n).replace(zp,(e,t)=>qp[t]??e)}function ui(n){return`${n}`}var dt=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new lo,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=jp(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let r=e.fromObject[t],i=Array.isArray(r)?r.map(ui):[ui(r)];this.map.set(t,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(r=>{let i=e[r];Array.isArray(i)?i.forEach(o=>{t.push({param:r,value:o,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(ui(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let r=this.map.get(e.param)||[],i=r.indexOf(ui(e.value));i!==-1&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var ho=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function Gp(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Gl(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function Wl(n){return typeof Blob<"u"&&n instanceof Blob}function Kl(n){return typeof FormData<"u"&&n instanceof FormData}function Wp(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var Qn=class n{constructor(e,t,r,i){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let o;if(Gp(this.method)||i?(this.body=r!==void 0?r:null,o=i):o=r,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),this.transferCache=o.transferCache),this.headers??=new Ye,this.context??=new ho,!this.params)this.params=new dt,this.urlWithParams=t;else{let a=this.params.toString();if(a.length===0)this.urlWithParams=t;else{let c=t.indexOf("?"),h=c===-1?"?":c<t.length-1?"&":"";this.urlWithParams=t+h+a}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||Gl(this.body)||Wl(this.body)||Kl(this.body)||Wp(this.body)?this.body:this.body instanceof dt?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||Kl(this.body)?null:Wl(this.body)?this.body.type||null:Gl(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof dt?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,o=e.transferCache??this.transferCache,a=e.body!==void 0?e.body:this.body,c=e.withCredentials??this.withCredentials,h=e.reportProgress??this.reportProgress,d=e.headers||this.headers,p=e.params||this.params,v=e.context??this.context;return e.setHeaders!==void 0&&(d=Object.keys(e.setHeaders).reduce((A,S)=>A.set(S,e.setHeaders[S]),d)),e.setParams&&(p=Object.keys(e.setParams).reduce((A,S)=>A.set(S,e.setParams[S]),p)),new n(t,r,a,{params:p,headers:d,context:v,reportProgress:h,responseType:i,withCredentials:c,transferCache:o})}},ft=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(ft||{}),Jn=class{constructor(e,t=200,r="OK"){this.headers=e.headers||new Ye,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},li=class n extends Jn{constructor(e={}){super(e),this.type=ft.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Xn=class n extends Jn{constructor(e={}){super(e),this.type=ft.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},ht=class extends Jn{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},Jl=200,Kp=204;function co(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var mo=(()=>{class n{constructor(t){this.handler=t}request(t,r,i={}){let o;if(t instanceof Qn)o=t;else{let h;i.headers instanceof Ye?h=i.headers:h=new Ye(i.headers);let d;i.params&&(i.params instanceof dt?d=i.params:d=new dt({fromObject:i.params})),o=new Qn(t,r,i.body!==void 0?i.body:null,{headers:h,context:i.context,params:d,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials,transferCache:i.transferCache})}let a=Xs(o).pipe(bl(h=>this.handler.handle(h)));if(t instanceof Qn||i.observe==="events")return a;let c=a.pipe(Zs(h=>h instanceof Xn));switch(i.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return c.pipe(De(h=>{if(h.body!==null&&!(h.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return h.body}));case"blob":return c.pipe(De(h=>{if(h.body!==null&&!(h.body instanceof Blob))throw new Error("Response is not a Blob.");return h.body}));case"text":return c.pipe(De(h=>{if(h.body!==null&&typeof h.body!="string")throw new Error("Response is not a string.");return h.body}));case"json":default:return c.pipe(De(h=>h.body))}case"response":return c;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:new dt().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,i={}){return this.request("PATCH",t,co(i,r))}post(t,r,i={}){return this.request("POST",t,co(i,r))}put(t,r,i={}){return this.request("PUT",t,co(i,r))}static{this.\u0275fac=function(r){return new(r||n)(ve(Yn))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})(),Hp=/^\)\]\}',?\n/,Qp="X-Request-URL";function Hl(n){if(n.url)return n.url;let e=Qp.toLocaleLowerCase();return n.headers.get(e)}var Yp=(()=>{class n{constructor(){this.fetchImpl=se(fo,{optional:!0})?.fetch??((...t)=>globalThis.fetch(...t)),this.ngZone=se(Qe)}handle(t){return new ct(r=>{let i=new AbortController;return this.doRequest(t,i.signal,r).then(po,o=>r.error(new ht({error:o}))),()=>i.abort()})}doRequest(t,r,i){return D(this,null,function*(){let o=this.createRequestInit(t),a;try{let S=this.ngZone.runOutsideAngular(()=>this.fetchImpl(t.urlWithParams,Wn({signal:r},o)));Jp(S),i.next({type:ft.Sent}),a=yield S}catch(S){i.error(new ht({error:S,status:S.status??0,statusText:S.statusText,url:t.urlWithParams,headers:S.headers}));return}let c=new Ye(a.headers),h=a.statusText,d=Hl(a)??t.urlWithParams,p=a.status,v=null;if(t.reportProgress&&i.next(new li({headers:c,status:p,statusText:h,url:d})),a.body){let S=a.headers.get("content-length"),k=[],P=a.body.getReader(),R=0,V,$,L=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>D(this,null,function*(){for(;;){let{done:te,value:G}=yield P.read();if(te)break;if(k.push(G),R+=G.length,t.reportProgress){$=t.responseType==="text"?($??"")+(V??=new TextDecoder).decode(G,{stream:!0}):void 0;let E=()=>i.next({type:ft.DownloadProgress,total:S?+S:void 0,loaded:R,partialText:$});L?L.run(E):E()}}}));let Q=this.concatChunks(k,R);try{let te=a.headers.get("Content-Type")??"";v=this.parseBody(t,Q,te)}catch(te){i.error(new ht({error:te,headers:new Ye(a.headers),status:a.status,statusText:a.statusText,url:Hl(a)??t.urlWithParams}));return}}p===0&&(p=v?Jl:0),p>=200&&p<300?(i.next(new Xn({body:v,headers:c,status:p,statusText:h,url:d})),i.complete()):i.error(new ht({error:v,headers:c,status:p,statusText:h,url:d}))})}parseBody(t,r,i){switch(t.responseType){case"json":let o=new TextDecoder().decode(r).replace(Hp,"");return o===""?null:JSON.parse(o);case"text":return new TextDecoder().decode(r);case"blob":return new Blob([r],{type:i});case"arraybuffer":return r.buffer}}createRequestInit(t){let r={},i=t.withCredentials?"include":void 0;if(t.headers.forEach((o,a)=>r[o]=a.join(",")),t.headers.has("Accept")||(r.Accept="application/json, text/plain, */*"),!t.headers.has("Content-Type")){let o=t.detectContentTypeHeader();o!==null&&(r["Content-Type"]=o)}return{body:t.serializeBody(),method:t.method,headers:r,credentials:i}}concatChunks(t,r){let i=new Uint8Array(r),o=0;for(let a of t)i.set(a,o),o+=a.length;return i}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})(),fo=class{};function po(){}function Jp(n){n.then(po,po)}function Xp(n,e){return e(n)}function Zp(n,e,t){return(r,i)=>kl(t,()=>e(r,o=>n(o,i)))}var Xl=new be(""),em=new be(""),tm=new be("",{providedIn:"root",factory:()=>!0});var Ql=(()=>{class n extends Yn{constructor(t,r){super(),this.backend=t,this.injector=r,this.chain=null,this.pendingTasks=se(Ol),this.contributeToStability=se(tm)}handle(t){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(Xl),...this.injector.get(em,[])]));this.chain=r.reduceRight((i,o)=>Zp(i,o,this.injector),Xp)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(t,i=>this.backend.handle(i)).pipe(Sl(()=>this.pendingTasks.remove(r)))}else return this.chain(t,r=>this.backend.handle(r))}static{this.\u0275fac=function(r){return new(r||n)(ve(ci),ve(Nl))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})();var nm=/^\)\]\}',?\n/;function rm(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var Yl=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new ii(-2800,!1);let r=this.xhrFactory;return(r.\u0275loadImpl?Js(r.\u0275loadImpl()):Xs(null)).pipe(Cl(()=>new ct(o=>{let a=r.build();if(a.open(t.method,t.urlWithParams),t.withCredentials&&(a.withCredentials=!0),t.headers.forEach((P,R)=>a.setRequestHeader(P,R.join(","))),t.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){let P=t.detectContentTypeHeader();P!==null&&a.setRequestHeader("Content-Type",P)}if(t.responseType){let P=t.responseType.toLowerCase();a.responseType=P!=="json"?P:"text"}let c=t.serializeBody(),h=null,d=()=>{if(h!==null)return h;let P=a.statusText||"OK",R=new Ye(a.getAllResponseHeaders()),V=rm(a)||t.url;return h=new li({headers:R,status:a.status,statusText:P,url:V}),h},p=()=>{let{headers:P,status:R,statusText:V,url:$}=d(),L=null;R!==Kp&&(L=typeof a.response>"u"?a.responseText:a.response),R===0&&(R=L?Jl:0);let Q=R>=200&&R<300;if(t.responseType==="json"&&typeof L=="string"){let te=L;L=L.replace(nm,"");try{L=L!==""?JSON.parse(L):null}catch(G){L=te,Q&&(Q=!1,L={error:G,text:L})}}Q?(o.next(new Xn({body:L,headers:P,status:R,statusText:V,url:$||void 0})),o.complete()):o.error(new ht({error:L,headers:P,status:R,statusText:V,url:$||void 0}))},v=P=>{let{url:R}=d(),V=new ht({error:P,status:a.status||0,statusText:a.statusText||"Unknown Error",url:R||void 0});o.error(V)},A=!1,S=P=>{A||(o.next(d()),A=!0);let R={type:ft.DownloadProgress,loaded:P.loaded};P.lengthComputable&&(R.total=P.total),t.responseType==="text"&&a.responseText&&(R.partialText=a.responseText),o.next(R)},k=P=>{let R={type:ft.UploadProgress,loaded:P.loaded};P.lengthComputable&&(R.total=P.total),o.next(R)};return a.addEventListener("load",p),a.addEventListener("error",v),a.addEventListener("timeout",v),a.addEventListener("abort",v),t.reportProgress&&(a.addEventListener("progress",S),c!==null&&a.upload&&a.upload.addEventListener("progress",k)),a.send(c),o.next({type:ft.Sent}),()=>{a.removeEventListener("error",v),a.removeEventListener("abort",v),a.removeEventListener("load",p),a.removeEventListener("timeout",v),t.reportProgress&&(a.removeEventListener("progress",S),c!==null&&a.upload&&a.upload.removeEventListener("progress",k)),a.readyState!==a.DONE&&a.abort()}})))}static{this.\u0275fac=function(r){return new(r||n)(ve(si))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})(),Zl=new be(""),im="XSRF-TOKEN",sm=new be("",{providedIn:"root",factory:()=>im}),om="X-XSRF-TOKEN",am=new be("",{providedIn:"root",factory:()=>om}),hi=class{},um=(()=>{class n{constructor(t,r,i){this.doc=t,this.platform=r,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=zl(t,this.cookieName),this.lastCookieString=t),this.lastToken}static{this.\u0275fac=function(r){return new(r||n)(ve(ai),ve(Hn),ve(sm))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})();function cm(n,e){let t=n.url.toLowerCase();if(!se(Zl)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let r=se(hi).getToken(),i=se(am);return r!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,r)})),e(n)}function pw(...n){let e=[mo,Yl,Ql,{provide:Yn,useExisting:Ql},{provide:ci,useFactory:()=>se(Yp,{optional:!0})??se(Yl)},{provide:Xl,useValue:cm,multi:!0},{provide:Zl,useValue:!0},{provide:hi,useClass:um}];for(let t of n)e.push(...t.\u0275providers);return Xt(e)}var th=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},lm=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],c=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},nh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,c=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=o>>2,v=(o&3)<<4|c>>4,A=(c&15)<<2|d>>6,S=d&63;h||(S=64,a||(A=64)),r.push(t[p],t[v],t[A],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(th(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):lm(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let v=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||c==null||d==null||v==null)throw new yo;let A=o<<2|c>>4;if(r.push(A),d!==64){let S=c<<4&240|d>>2;if(r.push(S),v!==64){let k=d<<6&192|v;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},yo=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},hm=function(n){let e=th(n);return nh.encodeByteArray(e,!0)},Zn=function(n){return hm(n).replace(/\./g,"")},vo=function(n){try{return nh.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function dm(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var fm=()=>dm().__FIREBASE_DEFAULTS__,pm=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},mm=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&vo(n[1]);return e&&JSON.parse(e)},fi=()=>{try{return fm()||pm()||mm()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},rh=n=>{var e,t;return(t=(e=fi())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},ih=n=>{let e=rh(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Eo=()=>{var n;return(n=fi())===null||n===void 0?void 0:n.config},sh=n=>{var e;return(e=fi())===null||e===void 0?void 0:e[`_${n}`]};var di=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function oh(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Zn(JSON.stringify(t)),Zn(JSON.stringify(a)),""].join(".")}function Ce(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ah(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ce())}function gm(){var n;let e=(n=fi())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function uh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ch(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function lh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function hh(){return!gm()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function wo(){try{return typeof indexedDB=="object"}catch{return!1}}function dh(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}var ym="FirebaseError",ke=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=ym,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Je.prototype.create)}},Je=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?_m(o,r):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new ke(i,c,r)}};function _m(n,e){return n.replace(vm,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var vm=/\{\$([^}]+)}/g;function Zt(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(eh(o)&&eh(a)){if(!Zt(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function eh(n){return n!==null&&typeof n=="object"}function Io(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function fh(n,e){let t=new _o(n,e);return t.subscribe.bind(t)}var _o=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Em(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=go),i.error===void 0&&(i.error=go),i.complete===void 0&&(i.complete=go);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Em(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function go(){}var yw=4*60*60*1e3;function fe(n){return n&&n._delegate?n._delegate:n}var Oe=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Rt="[DEFAULT]";var To=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new di;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Im(e))try{this.getOrInitializeService({instanceIdentifier:Rt})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Rt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return D(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Rt){return this.instances.has(e)}getOptions(e=Rt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(o);r===c&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);let a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:wm(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Rt){return this.component?this.component.multipleInstances?e:Rt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function wm(n){return n===Rt?void 0:n}function Im(n){return n.instantiationMode==="EAGER"}var pi=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new To(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Tm=[],z=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(z||{}),Am={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},Dm=z.INFO,bm={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},Sm=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=bm[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},pt=class{constructor(e){this.name=e,this._logLevel=Dm,this._logHandler=Sm,this._userLogHandler=null,Tm.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Am[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...e),this._logHandler(this,z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...e),this._logHandler(this,z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,z.INFO,...e),this._logHandler(this,z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,z.WARN,...e),this._logHandler(this,z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...e),this._logHandler(this,z.ERROR,...e)}};var Cm=(n,e)=>e.some(t=>n instanceof t),ph,mh;function Rm(){return ph||(ph=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Pm(){return mh||(mh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var gh=new WeakMap,Do=new WeakMap,yh=new WeakMap,Ao=new WeakMap,So=new WeakMap;function Nm(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Ue(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&gh.set(t,n)}).catch(()=>{}),So.set(e,n),e}function km(n){if(Do.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Do.set(n,e)}var bo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Do.get(n);if(e==="objectStoreNames")return n.objectStoreNames||yh.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ue(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function _h(n){bo=n(bo)}function Om(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(mi(this),e,...t);return yh.set(r,e.sort?e.sort():[e]),Ue(r)}:Pm().includes(n)?function(...e){return n.apply(mi(this),e),Ue(gh.get(this))}:function(...e){return Ue(n.apply(mi(this),e))}}function Fm(n){return typeof n=="function"?Om(n):(n instanceof IDBTransaction&&km(n),Cm(n,Rm())?new Proxy(n,bo):n)}function Ue(n){if(n instanceof IDBRequest)return Nm(n);if(Ao.has(n))return Ao.get(n);let e=Fm(n);return e!==n&&(Ao.set(n,e),So.set(e,n)),e}var mi=n=>So.get(n);function Eh(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),c=Ue(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Ue(a.result),h.oldVersion,h.newVersion,Ue(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),c.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}var xm=["get","getKey","getAll","getAllKeys","count"],Lm=["put","add","delete","clear"],Co=new Map;function vh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Co.get(e))return Co.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Lm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||xm.includes(t)))return;let o=function(a,...c){return D(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(c.shift())),(yield Promise.all([d[t](...c),i&&h.done]))[0]})};return Co.set(e,o),o}_h(n=>Ks(Wn({},n),{get:(e,t,r)=>vh(e,t)||n.get(e,t,r),has:(e,t)=>!!vh(e,t)||n.has(e,t)}));var Po=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Mm(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function Mm(n){let e=n.getComponent();return e?.type==="VERSION"}var No="@firebase/app",wh="0.10.13";var Xe=new pt("@firebase/app"),Vm="@firebase/app-compat",Um="@firebase/analytics-compat",Bm="@firebase/analytics",$m="@firebase/app-check-compat",jm="@firebase/app-check",zm="@firebase/auth",qm="@firebase/auth-compat",Gm="@firebase/database",Wm="@firebase/data-connect",Km="@firebase/database-compat",Hm="@firebase/functions",Qm="@firebase/functions-compat",Ym="@firebase/installations",Jm="@firebase/installations-compat",Xm="@firebase/messaging",Zm="@firebase/messaging-compat",eg="@firebase/performance",tg="@firebase/performance-compat",ng="@firebase/remote-config",rg="@firebase/remote-config-compat",ig="@firebase/storage",sg="@firebase/storage-compat",og="@firebase/firestore",ag="@firebase/vertexai-preview",ug="@firebase/firestore-compat",cg="firebase",lg="10.14.1";var ko="[DEFAULT]",hg={[No]:"fire-core",[Vm]:"fire-core-compat",[Bm]:"fire-analytics",[Um]:"fire-analytics-compat",[jm]:"fire-app-check",[$m]:"fire-app-check-compat",[zm]:"fire-auth",[qm]:"fire-auth-compat",[Gm]:"fire-rtdb",[Wm]:"fire-data-connect",[Km]:"fire-rtdb-compat",[Hm]:"fire-fn",[Qm]:"fire-fn-compat",[Ym]:"fire-iid",[Jm]:"fire-iid-compat",[Xm]:"fire-fcm",[Zm]:"fire-fcm-compat",[eg]:"fire-perf",[tg]:"fire-perf-compat",[ng]:"fire-rc",[rg]:"fire-rc-compat",[ig]:"fire-gcs",[sg]:"fire-gcs-compat",[og]:"fire-fst",[ug]:"fire-fst-compat",[ag]:"fire-vertex","fire-js":"fire-js",[cg]:"fire-js-all"};var er=new Map,dg=new Map,Oo=new Map;function Ih(n,e){try{n.container.addComponent(e)}catch(t){Xe.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function gt(n){let e=n.name;if(Oo.has(e))return Xe.debug(`There were multiple attempts to register component ${e}.`),!1;Oo.set(e,n);for(let t of er.values())Ih(t,n);for(let t of dg.values())Ih(t,n);return!0}function Mo(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function en(n){return n.settings!==void 0}var fg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mt=new Je("app","Firebase",fg);var Fo=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Oe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mt.create("app-deleted",{appName:this._name})}};var tn=lg;function Vo(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:ko,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw mt.create("bad-app-name",{appName:String(i)});if(t||(t=Eo()),!t)throw mt.create("no-options");let o=er.get(i);if(o){if(Zt(t,o.options)&&Zt(r,o.config))return o;throw mt.create("duplicate-app",{appName:i})}let a=new pi(i);for(let h of Oo.values())a.addComponent(h);let c=new Fo(t,r,a);return er.set(i,c),c}function nr(n=ko){let e=er.get(n);if(!e&&n===ko&&Eo())return Vo();if(!e)throw mt.create("no-app",{appName:n});return e}function gi(){return Array.from(er.values())}function le(n,e,t){var r;let i=(r=hg[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){let c=[`Unable to register library "${i}" with version "${e}":`];o&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xe.warn(c.join(" "));return}gt(new Oe(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var pg="firebase-heartbeat-database",mg=1,tr="firebase-heartbeat-store",Ro=null;function bh(){return Ro||(Ro=Eh(pg,mg,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(tr)}catch(t){console.warn(t)}}}}).catch(n=>{throw mt.create("idb-open",{originalErrorMessage:n.message})})),Ro}function gg(n){return D(this,null,function*(){try{let t=(yield bh()).transaction(tr),r=yield t.objectStore(tr).get(Sh(n));return yield t.done,r}catch(e){if(e instanceof ke)Xe.warn(e.message);else{let t=mt.create("idb-get",{originalErrorMessage:e?.message});Xe.warn(t.message)}}})}function Th(n,e){return D(this,null,function*(){try{let r=(yield bh()).transaction(tr,"readwrite");yield r.objectStore(tr).put(e,Sh(n)),yield r.done}catch(t){if(t instanceof ke)Xe.warn(t.message);else{let r=mt.create("idb-set",{originalErrorMessage:t?.message});Xe.warn(r.message)}}})}function Sh(n){return`${n.name}!${n.options.appId}`}var yg=1024,_g=30*24*60*60*1e3,xo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Lo(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return D(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ah();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{let c=new Date(a.date).valueOf();return Date.now()-c<=_g}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Xe.warn(r)}})}getHeartbeatsHeader(){return D(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Ah(),{heartbeatsToSend:r,unsentEntries:i}=vg(this._heartbeatsCache.heartbeats),o=Zn(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Xe.warn(t),""}})}};function Ah(){return new Date().toISOString().substring(0,10)}function vg(n,e=yg){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Dh(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Dh(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Lo=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return D(this,null,function*(){return wo()?dh().then(()=>!0).catch(()=>!1):!1})}read(){return D(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield gg(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return D(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Th(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return D(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Th(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Dh(n){return Zn(JSON.stringify({version:2,heartbeats:n})).length}function Eg(n){gt(new Oe("platform-logger",e=>new Po(e),"PRIVATE")),gt(new Oe("heartbeat",e=>new xo(e),"PRIVATE")),le(No,wh,n),le(No,wh,"esm2017"),le("fire-js","")}Eg("");var wg="firebase",Ig="10.14.1";le(wg,Ig,"app");var rn=new so("ANGULARFIRE2_VERSION");function Bo(n,e,t){if(e){if(e.length===1)return e[0];let o=e.filter(a=>a.app===t);if(o.length===1)return o[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var ir=(n,e)=>{let t=e?[e]:gi(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},rr=class{constructor(){return ir(Tg)}},Tg="app-check";function nn(){}var yi=class{zone;delegate;constructor(e,t=Dl){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,o=function(a){i.runGuarded(()=>{e.apply(this,[a])})};return this.delegate.schedule(o,t,r)}},Uo=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",nn,{},nn,nn)),t.pipe(to({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},sr=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new yi(Zone.current)),this.insideAngular=t.run(()=>new yi(Zone.current,Al)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ve(Qe))};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function _i(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Ag(n){return _i().ngZone.runOutsideAngular(()=>n())}function Pt(n){return _i().ngZone.run(()=>n())}function Dg(n){return bg(_i())(n)}function bg(n){return function(t){return t=t.lift(new Uo(n.ngZone)),t.pipe(Ys(n.outsideAngular),Qs(n.insideAngular))}}var Sg=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Pt(()=>n.apply(void 0,r))},Le=(n,e)=>function(){let t,r=arguments;for(let o=0;o<arguments.length;o++)typeof r[o]=="function"&&(e&&(t||=Pt(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",nn,{},nn,nn))),r[o]=Sg(r[o],t));let i=Ag(()=>n.apply(this,r));if(!e)if(i instanceof ct){let o=_i();return i.pipe(Ys(o.outsideAngular),Qs(o.insideAngular))}else return Pt(()=>i);return i instanceof ct?i.pipe(Dg):i instanceof Promise?Pt(()=>new Promise((o,a)=>i.then(c=>Pt(()=>o(c)),c=>Pt(()=>a(c))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Pt(()=>i)};var Nt=class{constructor(e){return e}},or=class{constructor(){return gi()}};function Cg(n){return n&&n.length===1?n[0]:new Nt(nr())}var $o=new be("angularfire2._apps"),Rg={provide:Nt,useFactory:Cg,deps:[[new lt,$o]]},Pg={provide:or,deps:[[new lt,$o]]};function Ng(n){return(e,t)=>{let r=t.get(Hn);le("angularfire",rn.full,"core"),le("angularfire",rn.full,"app"),le("angular",xl.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new Nt(i)}}function rI(n,...e){return Xt([Rg,Pg,{provide:$o,useFactory:Ng(n),multi:!0,deps:[Qe,Kn,sr,...e]}])}var iI=Le(Vo,!0);function xh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Lh=xh,Mh=new Je("auth","Firebase",xh());var Ii=new pt("@firebase/auth");function Og(n,...e){Ii.logLevel<=z.WARN&&Ii.warn(`Auth (${tn}): ${n}`,...e)}function Ei(n,...e){Ii.logLevel<=z.ERROR&&Ii.error(`Auth (${tn}): ${n}`,...e)}function Ch(n,...e){throw Zo(n,...e)}function Xo(n,...e){return Zo(n,...e)}function Vh(n,e,t){let r=Object.assign(Object.assign({},Lh()),{[e]:t});return new Je("auth","Firebase",r).create(e,{appName:n.name})}function wi(n){return Vh(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Zo(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Mh.create(n,...e)}function Y(n,e,...t){if(!n)throw Zo(e,...t)}function ar(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ei(e),new Error(e)}function Ti(n,e){n||ar(e)}function Fg(){return Rh()==="http:"||Rh()==="https:"}function Rh(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function xg(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Fg()||ch()||"connection"in navigator)?navigator.onLine:!0}function Lg(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Ot=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ti(t>e,"Short delay should be less than long delay!"),this.isMobile=ah()||lh()}get(){return xg()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Mg(n,e){Ti(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Ai=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ar("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ar("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ar("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Vg={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var Ug=new Ot(3e4,6e4);function Uh(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Ci(o,a,c,h){return D(this,arguments,function*(n,e,t,r,i={}){return Bh(n,i,()=>D(this,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let v=Io(Object.assign({key:n.config.apiKey},p)).slice(1),A=yield n._getAdditionalHeaders();A["Content-Type"]="application/json",n.languageCode&&(A["X-Firebase-Locale"]=n.languageCode);let S=Object.assign({method:e,headers:A},d);return uh()||(S.referrerPolicy="no-referrer"),Ai.fetch()($h(n,n.config.apiHost,t,v),S)}))})}function Bh(n,e,t){return D(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},Vg),e);try{let i=new qo(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw vi(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let c=o.ok?a.errorMessage:a.error.message,[h,d]=c.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw vi(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw vi(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw vi(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Vh(n,p,d);Ch(n,p)}}catch(i){if(i instanceof ke)throw i;Ch(n,"network-request-failed",{message:String(i)})}})}function $h(n,e,t,r){let i=`${e}${t}?${r}`;return n.config.emulator?Mg(n.config,i):`${n.config.apiScheme}://${i}`}var qo=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Xo(this.auth,"network-request-failed")),Ug.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function vi(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Xo(n,e,r);return i.customData._tokenResponse=t,i}function Bg(n,e){return D(this,null,function*(){return Ci(n,"POST","/v1/accounts:delete",e)})}function jh(n,e){return D(this,null,function*(){return Ci(n,"POST","/v1/accounts:lookup",e)})}function ur(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function ea(n,e=!1){return D(this,null,function*(){let t=fe(n),r=yield t.getIdToken(e),i=zh(r);Y(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:ur(jo(i.auth_time)),issuedAtTime:ur(jo(i.iat)),expirationTime:ur(jo(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function jo(n){return Number(n)*1e3}function zh(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ei("JWT malformed, contained fewer than 3 sections"),null;try{let i=vo(t);return i?JSON.parse(i):(Ei("Failed to decode base64 JWT payload"),null)}catch(i){return Ei("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Ph(n){let e=zh(n);return Y(e,"internal-error"),Y(typeof e.exp<"u","internal-error"),Y(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Go(n,e,t=!1){return D(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof ke&&$g(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function $g({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Wo=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>D(this,null,function*(){yield this.iteration()}),t)}iteration(){return D(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var lr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ur(this.lastLoginAt),this.creationTime=ur(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Di(n){return D(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Go(n,jh(t,{idToken:r}));Y(i?.users.length,t,"internal-error");let o=i.users[0];n._notifyReloadListener(o);let a=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?qh(o.providerUserInfo):[],c=jg(n.providerData,a),h=n.isAnonymous,d=!(n.email&&o.passwordHash)&&!c?.length,p=h?d:!1,v={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new lr(o.createdAt,o.lastLoginAt),isAnonymous:p};Object.assign(n,v)})}function ta(n){return D(this,null,function*(){let e=fe(n);yield Di(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function jg(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function qh(n){return n.map(e=>{var{providerId:t}=e,r=Hs(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function zg(n,e){return D(this,null,function*(){let t=yield Bh(n,{},()=>D(this,null,function*(){let r=Io({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=$h(n,i,"/v1/token",`key=${o}`),c=yield n._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",Ai.fetch()(a,{method:"POST",headers:c,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function qg(n,e){return D(this,null,function*(){return Ci(n,"POST","/v2/accounts:revokeToken",Uh(n,e))})}var cr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Y(e.idToken,"internal-error"),Y(typeof e.idToken<"u","internal-error"),Y(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ph(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Y(e.length!==0,"internal-error");let t=Ph(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return D(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Y(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return D(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield zg(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(Y(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(Y(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(Y(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return ar("not implemented")}};function yt(n,e){Y(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var hr=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,o=Hs(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wo(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new lr(o.createdAt||void 0,o.lastLoginAt||void 0)}getIdToken(e){return D(this,null,function*(){let t=yield Go(this,this.stsTokenManager.getToken(this.auth,e));return Y(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return ea(this,e)}reload(){return ta(this)}_assign(e){this!==e&&(Y(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return D(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Di(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return D(this,null,function*(){if(en(this.auth.app))return Promise.reject(wi(this.auth));let e=yield this.getIdToken();return yield Go(this,Bg(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,o,a,c,h,d,p;let v=(r=t.displayName)!==null&&r!==void 0?r:void 0,A=(i=t.email)!==null&&i!==void 0?i:void 0,S=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,k=(a=t.photoURL)!==null&&a!==void 0?a:void 0,P=(c=t.tenantId)!==null&&c!==void 0?c:void 0,R=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,V=(d=t.createdAt)!==null&&d!==void 0?d:void 0,$=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:L,emailVerified:Q,isAnonymous:te,providerData:G,stsTokenManager:E}=t;Y(L&&E,e,"internal-error");let m=cr.fromJSON(this.name,E);Y(typeof L=="string",e,"internal-error"),yt(v,e.name),yt(A,e.name),Y(typeof Q=="boolean",e,"internal-error"),Y(typeof te=="boolean",e,"internal-error"),yt(S,e.name),yt(k,e.name),yt(P,e.name),yt(R,e.name),yt(V,e.name),yt($,e.name);let y=new n({uid:L,auth:e,email:A,emailVerified:Q,displayName:v,isAnonymous:te,photoURL:k,phoneNumber:S,tenantId:P,stsTokenManager:m,createdAt:V,lastLoginAt:$});return G&&Array.isArray(G)&&(y.providerData=G.map(_=>Object.assign({},_))),R&&(y._redirectEventId=R),y}static _fromIdTokenResponse(e,t,r=!1){return D(this,null,function*(){let i=new cr;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Di(o),o})}static _fromGetAccountInfoResponse(e,t,r){return D(this,null,function*(){let i=t.users[0];Y(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?qh(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,c=new cr;c.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new lr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,d),h})}};var Nh=new Map;function kt(n){Ti(n instanceof Function,"Expected a class definition");let e=Nh.get(n);return e?(Ti(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Nh.set(n,e),e)}var Gg=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return D(this,null,function*(){return!0})}_set(t,r){return D(this,null,function*(){this.storage[t]=r})}_get(t){return D(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return D(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Ko=Gg;function zo(n,e,t){return`firebase:${n}:${e}:${t}`}var bi=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=zo(this.userKey,i.apiKey,o),this.fullPersistenceKey=zo("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return D(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?hr._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return D(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return D(this,null,function*(){if(!t.length)return new n(kt(Ko),e,r);let i=(yield Promise.all(t.map(d=>D(this,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),o=i[0]||kt(Ko),a=zo(r,e.config.apiKey,e.name),c=null;for(let d of t)try{let p=yield d._get(a);if(p){let v=hr._fromJSON(e,p);d!==o&&(c=v),o=d;break}}catch{}let h=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],c&&(yield o._set(a,c.toJSON())),yield Promise.all(t.map(d=>D(this,null,function*(){if(d!==o)try{yield d._remove(a)}catch{}}))),new n(o,e,r))})}};function kh(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Qg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Wg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Jg(e))return"Blackberry";if(Xg(e))return"Webos";if(Kg(e))return"Safari";if((e.includes("chrome/")||Hg(e))&&!e.includes("edge/"))return"Chrome";if(Yg(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Wg(n=Ce()){return/firefox\//i.test(n)}function Kg(n=Ce()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Hg(n=Ce()){return/crios\//i.test(n)}function Qg(n=Ce()){return/iemobile/i.test(n)}function Yg(n=Ce()){return/android/i.test(n)}function Jg(n=Ce()){return/blackberry/i.test(n)}function Xg(n=Ce()){return/webos/i.test(n)}function Gh(n,e=[]){let t;switch(n){case"Browser":t=kh(Ce());break;case"Worker":t=`${kh(Ce())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${tn}/${r}`}var Ho=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,c)=>{try{let h=e(o);a(h)}catch(h){c(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return D(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Zg(t){return D(this,arguments,function*(n,e={}){return Ci(n,"GET","/v2/passwordPolicy",Uh(n,e))})}var ey=6,Qo=class{constructor(e){var t,r,i,o;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:ey,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,o,a,c;let h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(r=h.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(o=h.containsUppercaseLetter)!==null&&o!==void 0?o:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(c=h.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),h}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var Yo=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Si(this),this.idTokenSubscription=new Si(this),this.beforeStateQueue=new Ho(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Mh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=kt(t)),this._initializationPromise=this.queue(()=>D(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield bi.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return D(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return D(this,null,function*(){try{let t=yield jh(this,{idToken:e}),r=yield hr._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return D(this,null,function*(){var t;if(en(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,o=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,h=yield this.tryRedirectSignIn(e);(!a||a===c)&&h?.user&&(i=h.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Y(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return D(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return D(this,null,function*(){try{yield Di(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=Lg()}_delete(){return D(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return D(this,null,function*(){if(en(this.app))return Promise.reject(wi(this));let t=e?fe(e):null;return t&&Y(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return D(this,null,function*(){if(!this._deleted)return e&&Y(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>D(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return D(this,null,function*(){return en(this.app)?Promise.reject(wi(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return en(this.app)?Promise.reject(wi(this)):this.queue(()=>D(this,null,function*(){yield this.assertedPersistence.setPersistence(kt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return D(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return D(this,null,function*(){let e=yield Zg(this),t=new Qo(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Je("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return D(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield qg(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return D(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return D(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&kt(e)||this._popupRedirectResolver;Y(t,this,"argument-error"),this.redirectPersistenceManager=yield bi.create(this,[kt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return D(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>D(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return D(this,null,function*(){if(e===this.currentUser)return this.queue(()=>D(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Y(c,this,"internal-error"),c.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return D(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Gh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return D(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return D(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&Og(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function ty(n){return fe(n)}var Si=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=fh(t=>this.observer=t)}get next(){return Y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var ny={loadJS(){return D(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ry(n){ny=n}function iy(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function sy(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(kt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}var gI=iy("rcb"),yI=new Ot(3e4,6e4);var _I=new Ot(2e3,1e4);var vI=10*60*1e3;var EI=new Ot(3e4,6e4);var wI=new Ot(5e3,15e3);var II=encodeURIComponent("fac");var Oh="@firebase/auth",Fh="1.7.9";var Jo=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return D(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function oy(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ay(n){gt(new Oe("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;Y(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Gh(n)},d=new Yo(r,i,o,h);return sy(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),gt(new Oe("auth-internal",e=>{let t=ty(e.getProvider("auth").getImmediate());return(r=>new Jo(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),le(Oh,Fh,oy(n)),le(Oh,Fh,"esm2017")}var uy=5*60,TI=sh("authIdTokenMaxAge")||uy;function cy(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}ry({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=Xo("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",cy().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ay("Browser");var u_="auth";var Ri=class{constructor(){return ir(u_)}};var Wh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Kh={};var _t,na;(function(){var n;function e(E,m){function y(){}y.prototype=m.prototype,E.D=m.prototype,E.prototype=new y,E.prototype.constructor=E,E.C=function(_,w,T){for(var g=Array(arguments.length-2),We=2;We<arguments.length;We++)g[We-2]=arguments[We];return m.prototype[w].apply(_,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,m,y){y||(y=0);var _=Array(16);if(typeof m=="string")for(var w=0;16>w;++w)_[w]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(w=0;16>w;++w)_[w]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=E.g[0],y=E.g[1],w=E.g[2];var T=E.g[3],g=m+(T^y&(w^T))+_[0]+3614090360&4294967295;m=y+(g<<7&4294967295|g>>>25),g=T+(w^m&(y^w))+_[1]+3905402710&4294967295,T=m+(g<<12&4294967295|g>>>20),g=w+(y^T&(m^y))+_[2]+606105819&4294967295,w=T+(g<<17&4294967295|g>>>15),g=y+(m^w&(T^m))+_[3]+3250441966&4294967295,y=w+(g<<22&4294967295|g>>>10),g=m+(T^y&(w^T))+_[4]+4118548399&4294967295,m=y+(g<<7&4294967295|g>>>25),g=T+(w^m&(y^w))+_[5]+1200080426&4294967295,T=m+(g<<12&4294967295|g>>>20),g=w+(y^T&(m^y))+_[6]+2821735955&4294967295,w=T+(g<<17&4294967295|g>>>15),g=y+(m^w&(T^m))+_[7]+4249261313&4294967295,y=w+(g<<22&4294967295|g>>>10),g=m+(T^y&(w^T))+_[8]+1770035416&4294967295,m=y+(g<<7&4294967295|g>>>25),g=T+(w^m&(y^w))+_[9]+2336552879&4294967295,T=m+(g<<12&4294967295|g>>>20),g=w+(y^T&(m^y))+_[10]+4294925233&4294967295,w=T+(g<<17&4294967295|g>>>15),g=y+(m^w&(T^m))+_[11]+2304563134&4294967295,y=w+(g<<22&4294967295|g>>>10),g=m+(T^y&(w^T))+_[12]+1804603682&4294967295,m=y+(g<<7&4294967295|g>>>25),g=T+(w^m&(y^w))+_[13]+4254626195&4294967295,T=m+(g<<12&4294967295|g>>>20),g=w+(y^T&(m^y))+_[14]+2792965006&4294967295,w=T+(g<<17&4294967295|g>>>15),g=y+(m^w&(T^m))+_[15]+1236535329&4294967295,y=w+(g<<22&4294967295|g>>>10),g=m+(w^T&(y^w))+_[1]+4129170786&4294967295,m=y+(g<<5&4294967295|g>>>27),g=T+(y^w&(m^y))+_[6]+3225465664&4294967295,T=m+(g<<9&4294967295|g>>>23),g=w+(m^y&(T^m))+_[11]+643717713&4294967295,w=T+(g<<14&4294967295|g>>>18),g=y+(T^m&(w^T))+_[0]+3921069994&4294967295,y=w+(g<<20&4294967295|g>>>12),g=m+(w^T&(y^w))+_[5]+3593408605&4294967295,m=y+(g<<5&4294967295|g>>>27),g=T+(y^w&(m^y))+_[10]+38016083&4294967295,T=m+(g<<9&4294967295|g>>>23),g=w+(m^y&(T^m))+_[15]+3634488961&4294967295,w=T+(g<<14&4294967295|g>>>18),g=y+(T^m&(w^T))+_[4]+3889429448&4294967295,y=w+(g<<20&4294967295|g>>>12),g=m+(w^T&(y^w))+_[9]+568446438&4294967295,m=y+(g<<5&4294967295|g>>>27),g=T+(y^w&(m^y))+_[14]+3275163606&4294967295,T=m+(g<<9&4294967295|g>>>23),g=w+(m^y&(T^m))+_[3]+4107603335&4294967295,w=T+(g<<14&4294967295|g>>>18),g=y+(T^m&(w^T))+_[8]+1163531501&4294967295,y=w+(g<<20&4294967295|g>>>12),g=m+(w^T&(y^w))+_[13]+2850285829&4294967295,m=y+(g<<5&4294967295|g>>>27),g=T+(y^w&(m^y))+_[2]+4243563512&4294967295,T=m+(g<<9&4294967295|g>>>23),g=w+(m^y&(T^m))+_[7]+1735328473&4294967295,w=T+(g<<14&4294967295|g>>>18),g=y+(T^m&(w^T))+_[12]+2368359562&4294967295,y=w+(g<<20&4294967295|g>>>12),g=m+(y^w^T)+_[5]+4294588738&4294967295,m=y+(g<<4&4294967295|g>>>28),g=T+(m^y^w)+_[8]+2272392833&4294967295,T=m+(g<<11&4294967295|g>>>21),g=w+(T^m^y)+_[11]+1839030562&4294967295,w=T+(g<<16&4294967295|g>>>16),g=y+(w^T^m)+_[14]+4259657740&4294967295,y=w+(g<<23&4294967295|g>>>9),g=m+(y^w^T)+_[1]+2763975236&4294967295,m=y+(g<<4&4294967295|g>>>28),g=T+(m^y^w)+_[4]+1272893353&4294967295,T=m+(g<<11&4294967295|g>>>21),g=w+(T^m^y)+_[7]+4139469664&4294967295,w=T+(g<<16&4294967295|g>>>16),g=y+(w^T^m)+_[10]+3200236656&4294967295,y=w+(g<<23&4294967295|g>>>9),g=m+(y^w^T)+_[13]+681279174&4294967295,m=y+(g<<4&4294967295|g>>>28),g=T+(m^y^w)+_[0]+3936430074&4294967295,T=m+(g<<11&4294967295|g>>>21),g=w+(T^m^y)+_[3]+3572445317&4294967295,w=T+(g<<16&4294967295|g>>>16),g=y+(w^T^m)+_[6]+76029189&4294967295,y=w+(g<<23&4294967295|g>>>9),g=m+(y^w^T)+_[9]+3654602809&4294967295,m=y+(g<<4&4294967295|g>>>28),g=T+(m^y^w)+_[12]+3873151461&4294967295,T=m+(g<<11&4294967295|g>>>21),g=w+(T^m^y)+_[15]+530742520&4294967295,w=T+(g<<16&4294967295|g>>>16),g=y+(w^T^m)+_[2]+3299628645&4294967295,y=w+(g<<23&4294967295|g>>>9),g=m+(w^(y|~T))+_[0]+4096336452&4294967295,m=y+(g<<6&4294967295|g>>>26),g=T+(y^(m|~w))+_[7]+1126891415&4294967295,T=m+(g<<10&4294967295|g>>>22),g=w+(m^(T|~y))+_[14]+2878612391&4294967295,w=T+(g<<15&4294967295|g>>>17),g=y+(T^(w|~m))+_[5]+4237533241&4294967295,y=w+(g<<21&4294967295|g>>>11),g=m+(w^(y|~T))+_[12]+1700485571&4294967295,m=y+(g<<6&4294967295|g>>>26),g=T+(y^(m|~w))+_[3]+2399980690&4294967295,T=m+(g<<10&4294967295|g>>>22),g=w+(m^(T|~y))+_[10]+4293915773&4294967295,w=T+(g<<15&4294967295|g>>>17),g=y+(T^(w|~m))+_[1]+2240044497&4294967295,y=w+(g<<21&4294967295|g>>>11),g=m+(w^(y|~T))+_[8]+1873313359&4294967295,m=y+(g<<6&4294967295|g>>>26),g=T+(y^(m|~w))+_[15]+4264355552&4294967295,T=m+(g<<10&4294967295|g>>>22),g=w+(m^(T|~y))+_[6]+2734768916&4294967295,w=T+(g<<15&4294967295|g>>>17),g=y+(T^(w|~m))+_[13]+1309151649&4294967295,y=w+(g<<21&4294967295|g>>>11),g=m+(w^(y|~T))+_[4]+4149444226&4294967295,m=y+(g<<6&4294967295|g>>>26),g=T+(y^(m|~w))+_[11]+3174756917&4294967295,T=m+(g<<10&4294967295|g>>>22),g=w+(m^(T|~y))+_[2]+718787259&4294967295,w=T+(g<<15&4294967295|g>>>17),g=y+(T^(w|~m))+_[9]+3951481745&4294967295,E.g[0]=E.g[0]+m&4294967295,E.g[1]=E.g[1]+(w+(g<<21&4294967295|g>>>11))&4294967295,E.g[2]=E.g[2]+w&4294967295,E.g[3]=E.g[3]+T&4294967295}r.prototype.u=function(E,m){m===void 0&&(m=E.length);for(var y=m-this.blockSize,_=this.B,w=this.h,T=0;T<m;){if(w==0)for(;T<=y;)i(this,E,T),T+=this.blockSize;if(typeof E=="string"){for(;T<m;)if(_[w++]=E.charCodeAt(T++),w==this.blockSize){i(this,_),w=0;break}}else for(;T<m;)if(_[w++]=E[T++],w==this.blockSize){i(this,_),w=0;break}}this.h=w,this.o+=m},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var m=1;m<E.length-8;++m)E[m]=0;var y=8*this.o;for(m=E.length-8;m<E.length;++m)E[m]=y&255,y/=256;for(this.u(E),E=Array(16),m=y=0;4>m;++m)for(var _=0;32>_;_+=8)E[y++]=this.g[m]>>>_&255;return E};function o(E,m){var y=c;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=m(E)}function a(E,m){this.h=m;for(var y=[],_=!0,w=E.length-1;0<=w;w--){var T=E[w]|0;_&&T==m||(y[w]=T,_=!1)}this.g=y}var c={};function h(E){return-128<=E&&128>E?o(E,function(m){return new a([m|0],0>m?-1:0)}):new a([E|0],0>E?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return v;if(0>E)return R(d(-E));for(var m=[],y=1,_=0;E>=y;_++)m[_]=E/y|0,y*=4294967296;return new a(m,0)}function p(E,m){if(E.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(E.charAt(0)=="-")return R(p(E.substring(1),m));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=d(Math.pow(m,8)),_=v,w=0;w<E.length;w+=8){var T=Math.min(8,E.length-w),g=parseInt(E.substring(w,w+T),m);8>T?(T=d(Math.pow(m,T)),_=_.j(T).add(d(g))):(_=_.j(y),_=_.add(d(g)))}return _}var v=h(0),A=h(1),S=h(16777216);n=a.prototype,n.m=function(){if(P(this))return-R(this).m();for(var E=0,m=1,y=0;y<this.g.length;y++){var _=this.i(y);E+=(0<=_?_:4294967296+_)*m,m*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(k(this))return"0";if(P(this))return"-"+R(this).toString(E);for(var m=d(Math.pow(E,6)),y=this,_="";;){var w=Q(y,m).g;y=V(y,w.j(m));var T=((0<y.g.length?y.g[0]:y.h)>>>0).toString(E);if(y=w,k(y))return T+_;for(;6>T.length;)T="0"+T;_=T+_}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function k(E){if(E.h!=0)return!1;for(var m=0;m<E.g.length;m++)if(E.g[m]!=0)return!1;return!0}function P(E){return E.h==-1}n.l=function(E){return E=V(this,E),P(E)?-1:k(E)?0:1};function R(E){for(var m=E.g.length,y=[],_=0;_<m;_++)y[_]=~E.g[_];return new a(y,~E.h).add(A)}n.abs=function(){return P(this)?R(this):this},n.add=function(E){for(var m=Math.max(this.g.length,E.g.length),y=[],_=0,w=0;w<=m;w++){var T=_+(this.i(w)&65535)+(E.i(w)&65535),g=(T>>>16)+(this.i(w)>>>16)+(E.i(w)>>>16);_=g>>>16,T&=65535,g&=65535,y[w]=g<<16|T}return new a(y,y[y.length-1]&-2147483648?-1:0)};function V(E,m){return E.add(R(m))}n.j=function(E){if(k(this)||k(E))return v;if(P(this))return P(E)?R(this).j(R(E)):R(R(this).j(E));if(P(E))return R(this.j(R(E)));if(0>this.l(S)&&0>E.l(S))return d(this.m()*E.m());for(var m=this.g.length+E.g.length,y=[],_=0;_<2*m;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(var w=0;w<E.g.length;w++){var T=this.i(_)>>>16,g=this.i(_)&65535,We=E.i(w)>>>16,Sn=E.i(w)&65535;y[2*_+2*w]+=g*Sn,$(y,2*_+2*w),y[2*_+2*w+1]+=T*Sn,$(y,2*_+2*w+1),y[2*_+2*w+1]+=g*We,$(y,2*_+2*w+1),y[2*_+2*w+2]+=T*We,$(y,2*_+2*w+2)}for(_=0;_<m;_++)y[_]=y[2*_+1]<<16|y[2*_];for(_=m;_<2*m;_++)y[_]=0;return new a(y,0)};function $(E,m){for(;(E[m]&65535)!=E[m];)E[m+1]+=E[m]>>>16,E[m]&=65535,m++}function L(E,m){this.g=E,this.h=m}function Q(E,m){if(k(m))throw Error("division by zero");if(k(E))return new L(v,v);if(P(E))return m=Q(R(E),m),new L(R(m.g),R(m.h));if(P(m))return m=Q(E,R(m)),new L(R(m.g),m.h);if(30<E.g.length){if(P(E)||P(m))throw Error("slowDivide_ only works with positive integers.");for(var y=A,_=m;0>=_.l(E);)y=te(y),_=te(_);var w=G(y,1),T=G(_,1);for(_=G(_,2),y=G(y,2);!k(_);){var g=T.add(_);0>=g.l(E)&&(w=w.add(y),T=g),_=G(_,1),y=G(y,1)}return m=V(E,w.j(m)),new L(w,m)}for(w=v;0<=E.l(m);){for(y=Math.max(1,Math.floor(E.m()/m.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),T=d(y),g=T.j(m);P(g)||0<g.l(E);)y-=_,T=d(y),g=T.j(m);k(T)&&(T=A),w=w.add(T),E=V(E,g)}return new L(w,E)}n.A=function(E){return Q(this,E).h},n.and=function(E){for(var m=Math.max(this.g.length,E.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)&E.i(_);return new a(y,this.h&E.h)},n.or=function(E){for(var m=Math.max(this.g.length,E.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)|E.i(_);return new a(y,this.h|E.h)},n.xor=function(E){for(var m=Math.max(this.g.length,E.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)^E.i(_);return new a(y,this.h^E.h)};function te(E){for(var m=E.g.length+1,y=[],_=0;_<m;_++)y[_]=E.i(_)<<1|E.i(_-1)>>>31;return new a(y,E.h)}function G(E,m){var y=m>>5;m%=32;for(var _=E.g.length-y,w=[],T=0;T<_;T++)w[T]=0<m?E.i(T+y)>>>m|E.i(T+y+1)<<32-m:E.i(T+y);return new a(w,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,na=Kh.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,_t=Kh.Integer=a}).apply(typeof Wh<"u"?Wh:typeof self<"u"?self:typeof window<"u"?window:{});var Pi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ze={};var ra,c_,sn,ia,dr,Ni,sa,oa,aa;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,u,l){return s==Array.prototype||s==Object.prototype||(s[u]=l.value),s};function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof Pi=="object"&&Pi];for(var u=0;u<s.length;++u){var l=s[u];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(s,u){if(u)e:{var l=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var I=s[f];if(!(I in l))break e;l=l[I]}s=s[s.length-1],f=l[s],u=u(f),u!=f&&u!=null&&e(l,s,{configurable:!0,writable:!0,value:u})}}function o(s,u){s instanceof String&&(s+="");var l=0,f=!1,I={next:function(){if(!f&&l<s.length){var b=l++;return{value:u(b,s[b]),done:!1}}return f=!0,{done:!0,value:void 0}}};return I[Symbol.iterator]=function(){return I},I}i("Array.prototype.values",function(s){return s||function(){return o(this,function(u,l){return l})}});var a=a||{},c=this||self;function h(s){var u=typeof s;return u=u!="object"?u:s?Array.isArray(s)?"array":u:"null",u=="array"||u=="object"&&typeof s.length=="number"}function d(s){var u=typeof s;return u=="object"&&s!=null||u=="function"}function p(s,u,l){return s.call.apply(s.bind,arguments)}function v(s,u,l){if(!s)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var I=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(I,f),s.apply(u,I)}}return function(){return s.apply(u,arguments)}}function A(s,u,l){return A=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:v,A.apply(null,arguments)}function S(s,u){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function k(s,u){function l(){}l.prototype=u.prototype,s.aa=u.prototype,s.prototype=new l,s.prototype.constructor=s,s.Qb=function(f,I,b){for(var O=Array(arguments.length-2),X=2;X<arguments.length;X++)O[X-2]=arguments[X];return u.prototype[I].apply(f,O)}}function P(s){let u=s.length;if(0<u){let l=Array(u);for(let f=0;f<u;f++)l[f]=s[f];return l}return[]}function R(s,u){for(let l=1;l<arguments.length;l++){let f=arguments[l];if(h(f)){let I=s.length||0,b=f.length||0;s.length=I+b;for(let O=0;O<b;O++)s[I+O]=f[O]}else s.push(f)}}class V{constructor(u,l){this.i=u,this.j=l,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function $(s){return/^[\s\xa0]*$/.test(s)}function L(){var s=c.navigator;return s&&(s=s.userAgent)?s:""}function Q(s){return Q[" "](s),s}Q[" "]=function(){};var te=L().indexOf("Gecko")!=-1&&!(L().toLowerCase().indexOf("webkit")!=-1&&L().indexOf("Edge")==-1)&&!(L().indexOf("Trident")!=-1||L().indexOf("MSIE")!=-1)&&L().indexOf("Edge")==-1;function G(s,u,l){for(let f in s)u.call(l,s[f],f,s)}function E(s,u){for(let l in s)u.call(void 0,s[l],l,s)}function m(s){let u={};for(let l in s)u[l]=s[l];return u}let y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(s,u){let l,f;for(let I=1;I<arguments.length;I++){f=arguments[I];for(l in f)s[l]=f[l];for(let b=0;b<y.length;b++)l=y[b],Object.prototype.hasOwnProperty.call(f,l)&&(s[l]=f[l])}}function w(s){var u=1;s=s.split(":");let l=[];for(;0<u&&s.length;)l.push(s.shift()),u--;return s.length&&l.push(s.join(":")),l}function T(s){c.setTimeout(()=>{throw s},0)}function g(){var s=Is;let u=null;return s.g&&(u=s.g,s.g=s.g.next,s.g||(s.h=null),u.next=null),u}class We{constructor(){this.h=this.g=null}add(u,l){let f=Sn.get();f.set(u,l),this.h?this.h.next=f:this.g=f,this.h=f}}var Sn=new V(()=>new Gf,s=>s.reset());class Gf{constructor(){this.next=this.g=this.h=null}set(u,l){this.h=u,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let Cn,Rn=!1,Is=new We,Tc=()=>{let s=c.Promise.resolve(void 0);Cn=()=>{s.then(Wf)}};var Wf=()=>{for(var s;s=g();){try{s.h.call(s.g)}catch(l){T(l)}var u=Sn;u.j(s),100>u.h&&(u.h++,s.next=u.g,u.g=s)}Rn=!1};function st(){this.s=this.s,this.C=this.C}st.prototype.s=!1,st.prototype.ma=function(){this.s||(this.s=!0,this.N())},st.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function me(s,u){this.type=s,this.g=this.target=u,this.defaultPrevented=!1}me.prototype.h=function(){this.defaultPrevented=!0};var Kf=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var s=!1,u=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let l=()=>{};c.addEventListener("test",l,u),c.removeEventListener("test",l,u)}catch{}return s}();function Pn(s,u){if(me.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var l=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=u,u=s.relatedTarget){if(te){e:{try{Q(u.nodeName);var I=!0;break e}catch{}I=!1}I||(u=null)}}else l=="mouseover"?u=s.fromElement:l=="mouseout"&&(u=s.toElement);this.relatedTarget=u,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:Hf[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&Pn.aa.h.call(this)}}k(Pn,me);var Hf={2:"touch",3:"pen",4:"mouse"};Pn.prototype.h=function(){Pn.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var Nn="closure_listenable_"+(1e6*Math.random()|0),Qf=0;function Yf(s,u,l,f,I){this.listener=s,this.proxy=null,this.src=u,this.type=l,this.capture=!!f,this.ha=I,this.key=++Qf,this.da=this.fa=!1}function Vr(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function Ur(s){this.src=s,this.g={},this.h=0}Ur.prototype.add=function(s,u,l,f,I){var b=s.toString();s=this.g[b],s||(s=this.g[b]=[],this.h++);var O=As(s,u,f,I);return-1<O?(u=s[O],l||(u.fa=!1)):(u=new Yf(u,this.src,b,!!f,I),u.fa=l,s.push(u)),u};function Ts(s,u){var l=u.type;if(l in s.g){var f=s.g[l],I=Array.prototype.indexOf.call(f,u,void 0),b;(b=0<=I)&&Array.prototype.splice.call(f,I,1),b&&(Vr(u),s.g[l].length==0&&(delete s.g[l],s.h--))}}function As(s,u,l,f){for(var I=0;I<s.length;++I){var b=s[I];if(!b.da&&b.listener==u&&b.capture==!!l&&b.ha==f)return I}return-1}var Ds="closure_lm_"+(1e6*Math.random()|0),bs={};function Ac(s,u,l,f,I){if(f&&f.once)return bc(s,u,l,f,I);if(Array.isArray(u)){for(var b=0;b<u.length;b++)Ac(s,u[b],l,f,I);return null}return l=Ps(l),s&&s[Nn]?s.K(u,l,d(f)?!!f.capture:!!f,I):Dc(s,u,l,!1,f,I)}function Dc(s,u,l,f,I,b){if(!u)throw Error("Invalid event type");var O=d(I)?!!I.capture:!!I,X=Cs(s);if(X||(s[Ds]=X=new Ur(s)),l=X.add(u,l,f,O,b),l.proxy)return l;if(f=Jf(),l.proxy=f,f.src=s,f.listener=l,s.addEventListener)Kf||(I=O),I===void 0&&(I=!1),s.addEventListener(u.toString(),f,I);else if(s.attachEvent)s.attachEvent(Cc(u.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Jf(){function s(l){return u.call(s.src,s.listener,l)}let u=Xf;return s}function bc(s,u,l,f,I){if(Array.isArray(u)){for(var b=0;b<u.length;b++)bc(s,u[b],l,f,I);return null}return l=Ps(l),s&&s[Nn]?s.L(u,l,d(f)?!!f.capture:!!f,I):Dc(s,u,l,!0,f,I)}function Sc(s,u,l,f,I){if(Array.isArray(u))for(var b=0;b<u.length;b++)Sc(s,u[b],l,f,I);else f=d(f)?!!f.capture:!!f,l=Ps(l),s&&s[Nn]?(s=s.i,u=String(u).toString(),u in s.g&&(b=s.g[u],l=As(b,l,f,I),-1<l&&(Vr(b[l]),Array.prototype.splice.call(b,l,1),b.length==0&&(delete s.g[u],s.h--)))):s&&(s=Cs(s))&&(u=s.g[u.toString()],s=-1,u&&(s=As(u,l,f,I)),(l=-1<s?u[s]:null)&&Ss(l))}function Ss(s){if(typeof s!="number"&&s&&!s.da){var u=s.src;if(u&&u[Nn])Ts(u.i,s);else{var l=s.type,f=s.proxy;u.removeEventListener?u.removeEventListener(l,f,s.capture):u.detachEvent?u.detachEvent(Cc(l),f):u.addListener&&u.removeListener&&u.removeListener(f),(l=Cs(u))?(Ts(l,s),l.h==0&&(l.src=null,u[Ds]=null)):Vr(s)}}}function Cc(s){return s in bs?bs[s]:bs[s]="on"+s}function Xf(s,u){if(s.da)s=!0;else{u=new Pn(u,this);var l=s.listener,f=s.ha||s.src;s.fa&&Ss(s),s=l.call(f,u)}return s}function Cs(s){return s=s[Ds],s instanceof Ur?s:null}var Rs="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ps(s){return typeof s=="function"?s:(s[Rs]||(s[Rs]=function(u){return s.handleEvent(u)}),s[Rs])}function ge(){st.call(this),this.i=new Ur(this),this.M=this,this.F=null}k(ge,st),ge.prototype[Nn]=!0,ge.prototype.removeEventListener=function(s,u,l,f){Sc(this,s,u,l,f)};function Te(s,u){var l,f=s.F;if(f)for(l=[];f;f=f.F)l.push(f);if(s=s.M,f=u.type||u,typeof u=="string")u=new me(u,s);else if(u instanceof me)u.target=u.target||s;else{var I=u;u=new me(f,s),_(u,I)}if(I=!0,l)for(var b=l.length-1;0<=b;b--){var O=u.g=l[b];I=Br(O,f,!0,u)&&I}if(O=u.g=s,I=Br(O,f,!0,u)&&I,I=Br(O,f,!1,u)&&I,l)for(b=0;b<l.length;b++)O=u.g=l[b],I=Br(O,f,!1,u)&&I}ge.prototype.N=function(){if(ge.aa.N.call(this),this.i){var s=this.i,u;for(u in s.g){for(var l=s.g[u],f=0;f<l.length;f++)Vr(l[f]);delete s.g[u],s.h--}}this.F=null},ge.prototype.K=function(s,u,l,f){return this.i.add(String(s),u,!1,l,f)},ge.prototype.L=function(s,u,l,f){return this.i.add(String(s),u,!0,l,f)};function Br(s,u,l,f){if(u=s.i.g[String(u)],!u)return!0;u=u.concat();for(var I=!0,b=0;b<u.length;++b){var O=u[b];if(O&&!O.da&&O.capture==l){var X=O.listener,de=O.ha||O.src;O.fa&&Ts(s.i,O),I=X.call(de,f)!==!1&&I}}return I&&!f.defaultPrevented}function Rc(s,u,l){if(typeof s=="function")l&&(s=A(s,l));else if(s&&typeof s.handleEvent=="function")s=A(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(s,u||0)}function Pc(s){s.g=Rc(()=>{s.g=null,s.i&&(s.i=!1,Pc(s))},s.l);let u=s.h;s.h=null,s.m.apply(null,u)}class Zf extends st{constructor(u,l){super(),this.m=u,this.l=l,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Pc(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kn(s){st.call(this),this.h=s,this.g={}}k(kn,st);var Nc=[];function kc(s){G(s.g,function(u,l){this.g.hasOwnProperty(l)&&Ss(u)},s),s.g={}}kn.prototype.N=function(){kn.aa.N.call(this),kc(this)},kn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ns=c.JSON.stringify,ep=c.JSON.parse,tp=class{stringify(s){return c.JSON.stringify(s,void 0)}parse(s){return c.JSON.parse(s,void 0)}};function ks(){}ks.prototype.h=null;function Oc(s){return s.h||(s.h=s.i())}function Fc(){}var On={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Os(){me.call(this,"d")}k(Os,me);function Fs(){me.call(this,"c")}k(Fs,me);var At={},xc=null;function $r(){return xc=xc||new ge}At.La="serverreachability";function Lc(s){me.call(this,At.La,s)}k(Lc,me);function Fn(s){let u=$r();Te(u,new Lc(u))}At.STAT_EVENT="statevent";function Mc(s,u){me.call(this,At.STAT_EVENT,s),this.stat=u}k(Mc,me);function Ae(s){let u=$r();Te(u,new Mc(u,s))}At.Ma="timingevent";function Vc(s,u){me.call(this,At.Ma,s),this.size=u}k(Vc,me);function xn(s,u){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){s()},u)}function Ln(){this.g=!0}Ln.prototype.xa=function(){this.g=!1};function np(s,u,l,f,I,b){s.info(function(){if(s.g)if(b)for(var O="",X=b.split("&"),de=0;de<X.length;de++){var K=X[de].split("=");if(1<K.length){var ye=K[0];K=K[1];var _e=ye.split("_");O=2<=_e.length&&_e[1]=="type"?O+(ye+"="+K+"&"):O+(ye+"=redacted&")}}else O=null;else O=b;return"XMLHTTP REQ ("+f+") [attempt "+I+"]: "+u+`
`+l+`
`+O})}function rp(s,u,l,f,I,b,O){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+I+"]: "+u+`
`+l+`
`+b+" "+O})}function Ht(s,u,l,f){s.info(function(){return"XMLHTTP TEXT ("+u+"): "+sp(s,l)+(f?" "+f:"")})}function ip(s,u){s.info(function(){return"TIMEOUT: "+u})}Ln.prototype.info=function(){};function sp(s,u){if(!s.g)return u;if(!u)return null;try{var l=JSON.parse(u);if(l){for(s=0;s<l.length;s++)if(Array.isArray(l[s])){var f=l[s];if(!(2>f.length)){var I=f[1];if(Array.isArray(I)&&!(1>I.length)){var b=I[0];if(b!="noop"&&b!="stop"&&b!="close")for(var O=1;O<I.length;O++)I[O]=""}}}}return Ns(l)}catch{return u}}var jr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Uc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},xs;function zr(){}k(zr,ks),zr.prototype.g=function(){return new XMLHttpRequest},zr.prototype.i=function(){return{}},xs=new zr;function ot(s,u,l,f){this.j=s,this.i=u,this.l=l,this.R=f||1,this.U=new kn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Bc}function Bc(){this.i=null,this.g="",this.h=!1}var $c={},Ls={};function Ms(s,u,l){s.L=1,s.v=Kr(Ke(u)),s.m=l,s.P=!0,jc(s,null)}function jc(s,u){s.F=Date.now(),qr(s),s.A=Ke(s.v);var l=s.A,f=s.R;Array.isArray(f)||(f=[String(f)]),nl(l.i,"t",f),s.C=0,l=s.j.J,s.h=new Bc,s.g=El(s.j,l?u:null,!s.m),0<s.O&&(s.M=new Zf(A(s.Y,s,s.g),s.O)),u=s.U,l=s.g,f=s.ca;var I="readystatechange";Array.isArray(I)||(I&&(Nc[0]=I.toString()),I=Nc);for(var b=0;b<I.length;b++){var O=Ac(l,I[b],f||u.handleEvent,!1,u.h||u);if(!O)break;u.g[O.key]=O}u=s.H?m(s.H):{},s.m?(s.u||(s.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,u)):(s.u="GET",s.g.ea(s.A,s.u,null,u)),Fn(),np(s.i,s.u,s.A,s.l,s.R,s.m)}ot.prototype.ca=function(s){s=s.target;let u=this.M;u&&He(s)==3?u.j():this.Y(s)},ot.prototype.Y=function(s){try{if(s==this.g)e:{let _e=He(this.g);var u=this.g.Ba();let Jt=this.g.Z();if(!(3>_e)&&(_e!=3||this.g&&(this.h.h||this.g.oa()||cl(this.g)))){this.J||_e!=4||u==7||(u==8||0>=Jt?Fn(3):Fn(2)),Vs(this);var l=this.g.Z();this.X=l;t:if(zc(this)){var f=cl(this.g);s="";var I=f.length,b=He(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Dt(this),Mn(this);var O="";break t}this.h.i=new c.TextDecoder}for(u=0;u<I;u++)this.h.h=!0,s+=this.h.i.decode(f[u],{stream:!(b&&u==I-1)});f.length=0,this.h.g+=s,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=l==200,rp(this.i,this.u,this.A,this.l,this.R,_e,l),this.o){if(this.T&&!this.K){t:{if(this.g){var X,de=this.g;if((X=de.g?de.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(X)){var K=X;break t}}K=null}if(l=K)Ht(this.i,this.l,l,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Us(this,l);else{this.o=!1,this.s=3,Ae(12),Dt(this),Mn(this);break e}}if(this.P){l=!0;let xe;for(;!this.J&&this.C<O.length;)if(xe=op(this,O),xe==Ls){_e==4&&(this.s=4,Ae(14),l=!1),Ht(this.i,this.l,null,"[Incomplete Response]");break}else if(xe==$c){this.s=4,Ae(15),Ht(this.i,this.l,O,"[Invalid Chunk]"),l=!1;break}else Ht(this.i,this.l,xe,null),Us(this,xe);if(zc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),_e!=4||O.length!=0||this.h.h||(this.s=1,Ae(16),l=!1),this.o=this.o&&l,!l)Ht(this.i,this.l,O,"[Invalid Chunked Response]"),Dt(this),Mn(this);else if(0<O.length&&!this.W){this.W=!0;var ye=this.j;ye.g==this&&ye.ba&&!ye.M&&(ye.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),Gs(ye),ye.M=!0,Ae(11))}}else Ht(this.i,this.l,O,null),Us(this,O);_e==4&&Dt(this),this.o&&!this.J&&(_e==4?gl(this.j,this):(this.o=!1,qr(this)))}else Tp(this.g),l==400&&0<O.indexOf("Unknown SID")?(this.s=3,Ae(12)):(this.s=0,Ae(13)),Dt(this),Mn(this)}}}catch{}finally{}};function zc(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function op(s,u){var l=s.C,f=u.indexOf(`
`,l);return f==-1?Ls:(l=Number(u.substring(l,f)),isNaN(l)?$c:(f+=1,f+l>u.length?Ls:(u=u.slice(f,f+l),s.C=f+l,u)))}ot.prototype.cancel=function(){this.J=!0,Dt(this)};function qr(s){s.S=Date.now()+s.I,qc(s,s.I)}function qc(s,u){if(s.B!=null)throw Error("WatchDog timer not null");s.B=xn(A(s.ba,s),u)}function Vs(s){s.B&&(c.clearTimeout(s.B),s.B=null)}ot.prototype.ba=function(){this.B=null;let s=Date.now();0<=s-this.S?(ip(this.i,this.A),this.L!=2&&(Fn(),Ae(17)),Dt(this),this.s=2,Mn(this)):qc(this,this.S-s)};function Mn(s){s.j.G==0||s.J||gl(s.j,s)}function Dt(s){Vs(s);var u=s.M;u&&typeof u.ma=="function"&&u.ma(),s.M=null,kc(s.U),s.g&&(u=s.g,s.g=null,u.abort(),u.ma())}function Us(s,u){try{var l=s.j;if(l.G!=0&&(l.g==s||Bs(l.h,s))){if(!s.K&&Bs(l.h,s)&&l.G==3){try{var f=l.Da.g.parse(u)}catch{f=null}if(Array.isArray(f)&&f.length==3){var I=f;if(I[0]==0){e:if(!l.u){if(l.g)if(l.g.F+3e3<s.F)Xr(l),Yr(l);else break e;qs(l),Ae(18)}}else l.za=I[1],0<l.za-l.T&&37500>I[2]&&l.F&&l.v==0&&!l.C&&(l.C=xn(A(l.Za,l),6e3));if(1>=Kc(l.h)&&l.ca){try{l.ca()}catch{}l.ca=void 0}}else St(l,11)}else if((s.K||l.g==s)&&Xr(l),!$(u))for(I=l.Da.g.parse(u),u=0;u<I.length;u++){let K=I[u];if(l.T=K[0],K=K[1],l.G==2)if(K[0]=="c"){l.K=K[1],l.ia=K[2];let ye=K[3];ye!=null&&(l.la=ye,l.j.info("VER="+l.la));let _e=K[4];_e!=null&&(l.Aa=_e,l.j.info("SVER="+l.Aa));let Jt=K[5];Jt!=null&&typeof Jt=="number"&&0<Jt&&(f=1.5*Jt,l.L=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;let xe=s.g;if(xe){let ei=xe.g?xe.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ei){var b=f.h;b.g||ei.indexOf("spdy")==-1&&ei.indexOf("quic")==-1&&ei.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&($s(b,b.h),b.h=null))}if(f.D){let Ws=xe.g?xe.g.getResponseHeader("X-HTTP-Session-Id"):null;Ws&&(f.ya=Ws,Z(f.I,f.D,Ws))}}l.G=3,l.l&&l.l.ua(),l.ba&&(l.R=Date.now()-s.F,l.j.info("Handshake RTT: "+l.R+"ms")),f=l;var O=s;if(f.qa=vl(f,f.J?f.ia:null,f.W),O.K){Hc(f.h,O);var X=O,de=f.L;de&&(X.I=de),X.B&&(Vs(X),qr(X)),f.g=O}else pl(f);0<l.i.length&&Jr(l)}else K[0]!="stop"&&K[0]!="close"||St(l,7);else l.G==3&&(K[0]=="stop"||K[0]=="close"?K[0]=="stop"?St(l,7):zs(l):K[0]!="noop"&&l.l&&l.l.ta(K),l.v=0)}}Fn(4)}catch{}}var ap=class{constructor(s,u){this.g=s,this.map=u}};function Gc(s){this.l=s||10,c.PerformanceNavigationTiming?(s=c.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Wc(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Kc(s){return s.h?1:s.g?s.g.size:0}function Bs(s,u){return s.h?s.h==u:s.g?s.g.has(u):!1}function $s(s,u){s.g?s.g.add(u):s.h=u}function Hc(s,u){s.h&&s.h==u?s.h=null:s.g&&s.g.has(u)&&s.g.delete(u)}Gc.prototype.cancel=function(){if(this.i=Qc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function Qc(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let u=s.i;for(let l of s.g.values())u=u.concat(l.D);return u}return P(s.i)}function up(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(h(s)){for(var u=[],l=s.length,f=0;f<l;f++)u.push(s[f]);return u}u=[],l=0;for(f in s)u[l++]=s[f];return u}function cp(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(h(s)||typeof s=="string"){var u=[];s=s.length;for(var l=0;l<s;l++)u.push(l);return u}u=[],l=0;for(let f in s)u[l++]=f;return u}}}function Yc(s,u){if(s.forEach&&typeof s.forEach=="function")s.forEach(u,void 0);else if(h(s)||typeof s=="string")Array.prototype.forEach.call(s,u,void 0);else for(var l=cp(s),f=up(s),I=f.length,b=0;b<I;b++)u.call(void 0,f[b],l&&l[b],s)}var Jc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lp(s,u){if(s){s=s.split("&");for(var l=0;l<s.length;l++){var f=s[l].indexOf("="),I=null;if(0<=f){var b=s[l].substring(0,f);I=s[l].substring(f+1)}else b=s[l];u(b,I?decodeURIComponent(I.replace(/\+/g," ")):"")}}}function bt(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof bt){this.h=s.h,Gr(this,s.j),this.o=s.o,this.g=s.g,Wr(this,s.s),this.l=s.l;var u=s.i,l=new Bn;l.i=u.i,u.g&&(l.g=new Map(u.g),l.h=u.h),Xc(this,l),this.m=s.m}else s&&(u=String(s).match(Jc))?(this.h=!1,Gr(this,u[1]||"",!0),this.o=Vn(u[2]||""),this.g=Vn(u[3]||"",!0),Wr(this,u[4]),this.l=Vn(u[5]||"",!0),Xc(this,u[6]||"",!0),this.m=Vn(u[7]||"")):(this.h=!1,this.i=new Bn(null,this.h))}bt.prototype.toString=function(){var s=[],u=this.j;u&&s.push(Un(u,Zc,!0),":");var l=this.g;return(l||u=="file")&&(s.push("//"),(u=this.o)&&s.push(Un(u,Zc,!0),"@"),s.push(encodeURIComponent(String(l)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.s,l!=null&&s.push(":",String(l))),(l=this.l)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(Un(l,l.charAt(0)=="/"?fp:dp,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",Un(l,mp)),s.join("")};function Ke(s){return new bt(s)}function Gr(s,u,l){s.j=l?Vn(u,!0):u,s.j&&(s.j=s.j.replace(/:$/,""))}function Wr(s,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);s.s=u}else s.s=null}function Xc(s,u,l){u instanceof Bn?(s.i=u,gp(s.i,s.h)):(l||(u=Un(u,pp)),s.i=new Bn(u,s.h))}function Z(s,u,l){s.i.set(u,l)}function Kr(s){return Z(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function Vn(s,u){return s?u?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function Un(s,u,l){return typeof s=="string"?(s=encodeURI(s).replace(u,hp),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function hp(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var Zc=/[#\/\?@]/g,dp=/[#\?:]/g,fp=/[#\?]/g,pp=/[#\?@]/g,mp=/#/g;function Bn(s,u){this.h=this.g=null,this.i=s||null,this.j=!!u}function at(s){s.g||(s.g=new Map,s.h=0,s.i&&lp(s.i,function(u,l){s.add(decodeURIComponent(u.replace(/\+/g," ")),l)}))}n=Bn.prototype,n.add=function(s,u){at(this),this.i=null,s=Qt(this,s);var l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(u),this.h+=1,this};function el(s,u){at(s),u=Qt(s,u),s.g.has(u)&&(s.i=null,s.h-=s.g.get(u).length,s.g.delete(u))}function tl(s,u){return at(s),u=Qt(s,u),s.g.has(u)}n.forEach=function(s,u){at(this),this.g.forEach(function(l,f){l.forEach(function(I){s.call(u,I,f,this)},this)},this)},n.na=function(){at(this);let s=Array.from(this.g.values()),u=Array.from(this.g.keys()),l=[];for(let f=0;f<u.length;f++){let I=s[f];for(let b=0;b<I.length;b++)l.push(u[f])}return l},n.V=function(s){at(this);let u=[];if(typeof s=="string")tl(this,s)&&(u=u.concat(this.g.get(Qt(this,s))));else{s=Array.from(this.g.values());for(let l=0;l<s.length;l++)u=u.concat(s[l])}return u},n.set=function(s,u){return at(this),this.i=null,s=Qt(this,s),tl(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[u]),this.h+=1,this},n.get=function(s,u){return s?(s=this.V(s),0<s.length?String(s[0]):u):u};function nl(s,u,l){el(s,u),0<l.length&&(s.i=null,s.g.set(Qt(s,u),P(l)),s.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],u=Array.from(this.g.keys());for(var l=0;l<u.length;l++){var f=u[l];let b=encodeURIComponent(String(f)),O=this.V(f);for(f=0;f<O.length;f++){var I=b;O[f]!==""&&(I+="="+encodeURIComponent(String(O[f]))),s.push(I)}}return this.i=s.join("&")};function Qt(s,u){return u=String(u),s.j&&(u=u.toLowerCase()),u}function gp(s,u){u&&!s.j&&(at(s),s.i=null,s.g.forEach(function(l,f){var I=f.toLowerCase();f!=I&&(el(this,f),nl(this,I,l))},s)),s.j=u}function yp(s,u){let l=new Ln;if(c.Image){let f=new Image;f.onload=S(ut,l,"TestLoadImage: loaded",!0,u,f),f.onerror=S(ut,l,"TestLoadImage: error",!1,u,f),f.onabort=S(ut,l,"TestLoadImage: abort",!1,u,f),f.ontimeout=S(ut,l,"TestLoadImage: timeout",!1,u,f),c.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else u(!1)}function _p(s,u){let l=new Ln,f=new AbortController,I=setTimeout(()=>{f.abort(),ut(l,"TestPingServer: timeout",!1,u)},1e4);fetch(s,{signal:f.signal}).then(b=>{clearTimeout(I),b.ok?ut(l,"TestPingServer: ok",!0,u):ut(l,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(I),ut(l,"TestPingServer: error",!1,u)})}function ut(s,u,l,f,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),f(l)}catch{}}function vp(){this.g=new tp}function Ep(s,u,l){let f=l||"";try{Yc(s,function(I,b){let O=I;d(I)&&(O=Ns(I)),u.push(f+b+"="+encodeURIComponent(O))})}catch(I){throw u.push(f+"type="+encodeURIComponent("_badmap")),I}}function $n(s){this.l=s.Ub||null,this.j=s.eb||!1}k($n,ks),$n.prototype.g=function(){return new Hr(this.l,this.j)},$n.prototype.i=function(s){return function(){return s}}({});function Hr(s,u){ge.call(this),this.D=s,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Hr,ge),n=Hr.prototype,n.open=function(s,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=u,this.readyState=1,zn(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(u.body=s),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,jn(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,zn(this)),this.g&&(this.readyState=3,zn(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;rl(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function rl(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var u=s.value?s.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!s.done}))&&(this.response=this.responseText+=u)}s.done?jn(this):zn(this),this.readyState==3&&rl(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,jn(this))},n.Qa=function(s){this.g&&(this.response=s,jn(this))},n.ga=function(){this.g&&jn(this)};function jn(s){s.readyState=4,s.l=null,s.j=null,s.v=null,zn(s)}n.setRequestHeader=function(s,u){this.u.append(s,u)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],u=this.h.entries();for(var l=u.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=u.next();return s.join(`\r
`)};function zn(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Hr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function il(s){let u="";return G(s,function(l,f){u+=f,u+=":",u+=l,u+=`\r
`}),u}function js(s,u,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=il(l),typeof s=="string"?l!=null&&encodeURIComponent(String(l)):Z(s,u,l))}function re(s){ge.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(re,ge);var wp=/^https?$/i,Ip=["POST","PUT"];n=re.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,u,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);u=u?u.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xs.g(),this.v=this.o?Oc(this.o):Oc(xs),this.g.onreadystatechange=A(this.Ea,this);try{this.B=!0,this.g.open(u,String(s),!0),this.B=!1}catch(b){sl(this,b);return}if(s=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var I in f)l.set(I,f[I]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let b of f.keys())l.set(b,f.get(b));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(b=>b.toLowerCase()=="content-type"),I=c.FormData&&s instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Ip,u,void 0))||f||I||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,O]of l)this.g.setRequestHeader(b,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ul(this),this.u=!0,this.g.send(s),this.u=!1}catch(b){sl(this,b)}};function sl(s,u){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=u,s.m=5,ol(s),Qr(s)}function ol(s){s.A||(s.A=!0,Te(s,"complete"),Te(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,Te(this,"complete"),Te(this,"abort"),Qr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qr(this,!0)),re.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?al(this):this.bb())},n.bb=function(){al(this)};function al(s){if(s.h&&typeof a<"u"&&(!s.v[1]||He(s)!=4||s.Z()!=2)){if(s.u&&He(s)==4)Rc(s.Ea,0,s);else if(Te(s,"readystatechange"),He(s)==4){s.h=!1;try{let O=s.Z();e:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var l;if(!(l=u)){var f;if(f=O===0){var I=String(s.D).match(Jc)[1]||null;!I&&c.self&&c.self.location&&(I=c.self.location.protocol.slice(0,-1)),f=!wp.test(I?I.toLowerCase():"")}l=f}if(l)Te(s,"complete"),Te(s,"success");else{s.m=6;try{var b=2<He(s)?s.g.statusText:""}catch{b=""}s.l=b+" ["+s.Z()+"]",ol(s)}}finally{Qr(s)}}}}function Qr(s,u){if(s.g){ul(s);let l=s.g,f=s.v[0]?()=>{}:null;s.g=null,s.v=null,u||Te(s,"ready");try{l.onreadystatechange=f}catch{}}}function ul(s){s.I&&(c.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function He(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<He(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var u=this.g.responseText;return s&&u.indexOf(s)==0&&(u=u.substring(s.length)),ep(u)}};function cl(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Tp(s){let u={};s=(s.g&&2<=He(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if($(s[f]))continue;var l=w(s[f]);let I=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let b=u[I]||[];u[I]=b,b.push(l)}E(u,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function qn(s,u,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||u}function ll(s){this.Aa=0,this.i=[],this.j=new Ln,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=qn("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=qn("baseRetryDelayMs",5e3,s),this.cb=qn("retryDelaySeedMs",1e4,s),this.Wa=qn("forwardChannelMaxRetries",2,s),this.wa=qn("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new Gc(s&&s.concurrentRequestLimit),this.Da=new vp,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ll.prototype,n.la=8,n.G=1,n.connect=function(s,u,l,f){Ae(0),this.W=s,this.H=u||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.I=vl(this,null,this.W),Jr(this)};function zs(s){if(hl(s),s.G==3){var u=s.U++,l=Ke(s.I);if(Z(l,"SID",s.K),Z(l,"RID",u),Z(l,"TYPE","terminate"),Gn(s,l),u=new ot(s,s.j,u),u.L=2,u.v=Kr(Ke(l)),l=!1,c.navigator&&c.navigator.sendBeacon)try{l=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!l&&c.Image&&(new Image().src=u.v,l=!0),l||(u.g=El(u.j,null),u.g.ea(u.v)),u.F=Date.now(),qr(u)}_l(s)}function Yr(s){s.g&&(Gs(s),s.g.cancel(),s.g=null)}function hl(s){Yr(s),s.u&&(c.clearTimeout(s.u),s.u=null),Xr(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&c.clearTimeout(s.s),s.s=null)}function Jr(s){if(!Wc(s.h)&&!s.s){s.s=!0;var u=s.Ga;Cn||Tc(),Rn||(Cn(),Rn=!0),Is.add(u,s),s.B=0}}function Ap(s,u){return Kc(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=u.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=xn(A(s.Ga,s,u),yl(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;let I=new ot(this,this.j,s),b=this.o;if(this.S&&(b?(b=m(b),_(b,this.S)):b=this.S),this.m!==null||this.O||(I.H=b,b=null),this.P)e:{for(var u=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(u+=f,4096<u){u=l;break e}if(u===4096||l===this.i.length-1){u=l+1;break e}}u=1e3}else u=1e3;u=fl(this,I,u),l=Ke(this.I),Z(l,"RID",s),Z(l,"CVER",22),this.D&&Z(l,"X-HTTP-Session-Id",this.D),Gn(this,l),b&&(this.O?u="headers="+encodeURIComponent(String(il(b)))+"&"+u:this.m&&js(l,this.m,b)),$s(this.h,I),this.Ua&&Z(l,"TYPE","init"),this.P?(Z(l,"$req",u),Z(l,"SID","null"),I.T=!0,Ms(I,l,null)):Ms(I,l,u),this.G=2}}else this.G==3&&(s?dl(this,s):this.i.length==0||Wc(this.h)||dl(this))};function dl(s,u){var l;u?l=u.l:l=s.U++;let f=Ke(s.I);Z(f,"SID",s.K),Z(f,"RID",l),Z(f,"AID",s.T),Gn(s,f),s.m&&s.o&&js(f,s.m,s.o),l=new ot(s,s.j,l,s.B+1),s.m===null&&(l.H=s.o),u&&(s.i=u.D.concat(s.i)),u=fl(s,l,1e3),l.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),$s(s.h,l),Ms(l,f,u)}function Gn(s,u){s.H&&G(s.H,function(l,f){Z(u,f,l)}),s.l&&Yc({},function(l,f){Z(u,f,l)})}function fl(s,u,l){l=Math.min(s.i.length,l);var f=s.l?A(s.l.Na,s.l,s):null;e:{var I=s.i;let b=-1;for(;;){let O=["count="+l];b==-1?0<l?(b=I[0].g,O.push("ofs="+b)):b=0:O.push("ofs="+b);let X=!0;for(let de=0;de<l;de++){let K=I[de].g,ye=I[de].map;if(K-=b,0>K)b=Math.max(0,I[de].g-100),X=!1;else try{Ep(ye,O,"req"+K+"_")}catch{f&&f(ye)}}if(X){f=O.join("&");break e}}}return s=s.i.splice(0,l),u.D=s,f}function pl(s){if(!s.g&&!s.u){s.Y=1;var u=s.Fa;Cn||Tc(),Rn||(Cn(),Rn=!0),Is.add(u,s),s.v=0}}function qs(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=xn(A(s.Fa,s),yl(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,ml(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=xn(A(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ae(10),Yr(this),ml(this))};function Gs(s){s.A!=null&&(c.clearTimeout(s.A),s.A=null)}function ml(s){s.g=new ot(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var u=Ke(s.qa);Z(u,"RID","rpc"),Z(u,"SID",s.K),Z(u,"AID",s.T),Z(u,"CI",s.F?"0":"1"),!s.F&&s.ja&&Z(u,"TO",s.ja),Z(u,"TYPE","xmlhttp"),Gn(s,u),s.m&&s.o&&js(u,s.m,s.o),s.L&&(s.g.I=s.L);var l=s.g;s=s.ia,l.L=1,l.v=Kr(Ke(u)),l.m=null,l.P=!0,jc(l,s)}n.Za=function(){this.C!=null&&(this.C=null,Yr(this),qs(this),Ae(19))};function Xr(s){s.C!=null&&(c.clearTimeout(s.C),s.C=null)}function gl(s,u){var l=null;if(s.g==u){Xr(s),Gs(s),s.g=null;var f=2}else if(Bs(s.h,u))l=u.D,Hc(s.h,u),f=1;else return;if(s.G!=0){if(u.o)if(f==1){l=u.m?u.m.length:0,u=Date.now()-u.F;var I=s.B;f=$r(),Te(f,new Vc(f,l)),Jr(s)}else pl(s);else if(I=u.s,I==3||I==0&&0<u.X||!(f==1&&Ap(s,u)||f==2&&qs(s)))switch(l&&0<l.length&&(u=s.h,u.i=u.i.concat(l)),I){case 1:St(s,5);break;case 4:St(s,10);break;case 3:St(s,6);break;default:St(s,2)}}}function yl(s,u){let l=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(l*=2),l*u}function St(s,u){if(s.j.info("Error code "+u),u==2){var l=A(s.fb,s),f=s.Xa;let I=!f;f=new bt(f||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Gr(f,"https"),Kr(f),I?yp(f.toString(),l):_p(f.toString(),l)}else Ae(2);s.G=0,s.l&&s.l.sa(u),_l(s),hl(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))};function _l(s){if(s.G=0,s.ka=[],s.l){let u=Qc(s.h);(u.length!=0||s.i.length!=0)&&(R(s.ka,u),R(s.ka,s.i),s.h.i.length=0,P(s.i),s.i.length=0),s.l.ra()}}function vl(s,u,l){var f=l instanceof bt?Ke(l):new bt(l);if(f.g!="")u&&(f.g=u+"."+f.g),Wr(f,f.s);else{var I=c.location;f=I.protocol,u=u?u+"."+I.hostname:I.hostname,I=+I.port;var b=new bt(null);f&&Gr(b,f),u&&(b.g=u),I&&Wr(b,I),l&&(b.l=l),f=b}return l=s.D,u=s.ya,l&&u&&Z(f,l,u),Z(f,"VER",s.la),Gn(s,f),f}function El(s,u,l){if(u&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=s.Ca&&!s.pa?new re(new $n({eb:l})):new re(s.pa),u.Ha(s.J),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function wl(){}n=wl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Zr(){}Zr.prototype.g=function(s,u){return new Se(s,u)};function Se(s,u){ge.call(this),this.g=new ll(u),this.l=s,this.h=u&&u.messageUrlParams||null,s=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(s?s["X-WebChannel-Content-Type"]=u.messageContentType:s={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(s?s["X-WebChannel-Client-Profile"]=u.va:s={"X-WebChannel-Client-Profile":u.va}),this.g.S=s,(s=u&&u.Sb)&&!$(s)&&(this.g.m=s),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!$(u)&&(this.g.D=u,s=this.h,s!==null&&u in s&&(s=this.h,u in s&&delete s[u])),this.j=new Yt(this)}k(Se,ge),Se.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Se.prototype.close=function(){zs(this.g)},Se.prototype.o=function(s){var u=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.u&&(l={},l.__data__=Ns(s),s=l);u.i.push(new ap(u.Ya++,s)),u.G==3&&Jr(u)},Se.prototype.N=function(){this.g.l=null,delete this.j,zs(this.g),delete this.g,Se.aa.N.call(this)};function Il(s){Os.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var u=s.__sm__;if(u){e:{for(let l in u){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,u=u!==null&&s in u?u[s]:void 0),this.data=u}else this.data=s}k(Il,Os);function Tl(){Fs.call(this),this.status=1}k(Tl,Fs);function Yt(s){this.g=s}k(Yt,wl),Yt.prototype.ua=function(){Te(this.g,"a")},Yt.prototype.ta=function(s){Te(this.g,new Il(s))},Yt.prototype.sa=function(s){Te(this.g,new Tl)},Yt.prototype.ra=function(){Te(this.g,"b")},Zr.prototype.createWebChannel=Zr.prototype.g,Se.prototype.send=Se.prototype.o,Se.prototype.open=Se.prototype.m,Se.prototype.close=Se.prototype.close,aa=Ze.createWebChannelTransport=function(){return new Zr},oa=Ze.getStatEventTarget=function(){return $r()},sa=Ze.Event=At,Ni=Ze.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},jr.NO_ERROR=0,jr.TIMEOUT=8,jr.HTTP_ERROR=6,dr=Ze.ErrorCode=jr,Uc.COMPLETE="complete",ia=Ze.EventType=Uc,Fc.EventType=On,On.OPEN="a",On.CLOSE="b",On.ERROR="c",On.MESSAGE="d",ge.prototype.listen=ge.prototype.K,sn=Ze.WebChannel=Fc,c_=Ze.FetchXmlHttpFactory=$n,re.prototype.listenOnce=re.prototype.L,re.prototype.getLastError=re.prototype.Ka,re.prototype.getLastErrorCode=re.prototype.Ba,re.prototype.getStatus=re.prototype.Z,re.prototype.getResponseJson=re.prototype.Oa,re.prototype.getResponseText=re.prototype.oa,re.prototype.send=re.prototype.ea,re.prototype.setWithCredentials=re.prototype.Ha,ra=Ze.XhrIo=re}).apply(typeof Pi<"u"?Pi:typeof self<"u"?self:typeof window<"u"?window:{});var Hh="@firebase/firestore";var he=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};he.UNAUTHENTICATED=new he(null),he.GOOGLE_CREDENTIALS=new he("google-credentials-uid"),he.FIRST_PARTY=new he("first-party-uid"),he.MOCK_USER=new he("mock-user");var Dn="10.14.0";var Mt=new pt("@firebase/firestore");function fr(){return Mt.logLevel}function x(n,...e){if(Mt.logLevel<=z.DEBUG){let t=e.map(Qu);Mt.debug(`Firestore (${Dn}): ${n}`,...t)}}function nt(n,...e){if(Mt.logLevel<=z.ERROR){let t=e.map(Qu);Mt.error(`Firestore (${Dn}): ${n}`,...t)}}function dn(n,...e){if(Mt.logLevel<=z.WARN){let t=e.map(Qu);Mt.warn(`Firestore (${Dn}): ${n}`,...t)}}function Qu(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function U(n="Unexpected state"){let e=`FIRESTORE (${Dn}) INTERNAL ASSERTION FAILED: `+n;throw nt(e),new Error(e)}function J(n,e){n||U()}function B(n,e){return n}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},F=class extends ke{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var et=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Li=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},fa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(he.UNAUTHENTICATED))}shutdown(){}},pa=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},ma=class{constructor(e){this.t=e,this.currentUser=he.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){J(this.o===void 0);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new et;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new et,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(()=>D(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},c=h=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?c(h):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new et)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(J(typeof r.accessToken=="string"),new Li(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return J(e===null||typeof e=="string"),new he(e)}},ga=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=he.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ya=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new ga(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(he.FIRST_PARTY))}shutdown(){}invalidateToken(){}},_a=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},va=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){J(this.o===void 0);let r=o=>{o.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.R;return this.R=o.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.A.getImmediate({optional:!0});o?i(o):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(J(typeof t.token=="string"),this.R=t.token,new _a(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function l_(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Mi=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=l_(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%e.length))}return r}};function H(n,e){return n<e?-1:n>e?1:0}function fn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var pe=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new F(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new F(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new F(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new F(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var j=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new pe(0,0))}static max(){return new n(new pe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Vi=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&U(),r===void 0?r=e.length-t:r>e.length-t&&U(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=e.get(i),a=t.get(i);if(o<a)return-1;if(o>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ne=class n extends Vi{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new F(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},h_=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Pe=class n extends Vi{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return h_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new F(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new F(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new F(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else c==="`"?(a=!a,i++):c!=="."||a?(r+=c,i++):(o(),i++)}if(o(),a)throw new F(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var M=class n{constructor(e){this.path=e}static fromPath(e){return new n(ne.fromString(e))}static fromName(e){return new n(ne.fromString(e).popFirst(5))}static empty(){return new n(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ne(e.slice()))}};var Ea=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Ea.UNKNOWN_ID=-1;function d_(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(r===1e9?new pe(t+1,0):new pe(t,r));return new Vt(i,M.empty(),e)}function f_(n){return new Vt(n.readTime,n.key,-1)}var Vt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(j.min(),M.empty(),-1)}static max(){return new n(j.max(),M.empty(),-1)}};function p_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:H(n.largestBatchId,e.largestBatchId))}var m_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",wa=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Or(n){return D(this,null,function*(){if(n.code!==C.FAILED_PRECONDITION||n.message!==m_)throw n;x("LocalStore","Unexpectedly lost primary lease")})}var N=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(c=>{++i,c.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),c=0;for(let h=0;h<o;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++c,c===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function g_(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Fr(n){return n.name==="IndexedDbTransactionError"}var Pd=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function fs(n){return n==null}function Er(n){return n===0&&1/n==-1/0}function y_(n){return typeof n=="number"&&Number.isInteger(n)&&!Er(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var __=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],A0=[...__,"documentOverlays"],v_=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],E_=v_,w_=[...E_,"indexConfiguration","indexState","indexEntries"];var D0=[...w_,"globals"];function Qh(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Gt(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Nd(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ie=class n{constructor(e,t){this.comparator=e,this.root=t||$e.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,$e.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$e.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cn(this.root,e,this.comparator,!1)}getReverseIterator(){return new cn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cn(this.root,e,this.comparator,!0)}},cn=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},$e=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};$e.EMPTY=null,$e.RED=!0,$e.BLACK=!1;$e.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,r,i,o){return this}insert(e,t,r){return new $e(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var we=class n{constructor(e){this.comparator=e,this.data=new ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ui(this.data.getIterator())}getIteratorFrom(e){return new Ui(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Ui=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Fe=class n{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new n([])}unionWith(e){let t=new we(Pe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return fn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Bi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ie=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Bi("Invalid base64 string: "+o):o}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ie.EMPTY_BYTE_STRING=new Ie("");var I_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rt(n){if(J(!!n),typeof n=="string"){let e=0,t=I_.exec(n);if(J(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Et(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}function Yu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Ju(n){let e=n.mapValue.fields.__previous_value__;return Yu(e)?Ju(e):e}function wr(n){let e=rt(n.mapValue.fields.__local_write_time__.timestampValue);return new pe(e.seconds,e.nanos)}var Ia=class{constructor(e,t,r,i,o,a,c,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=h,this.useFetchStreams=d}},$i=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var ki={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ut(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Yu(n)?4:Od(n)?9007199254740991:kd(n)?10:11:U()}function qe(n,e){if(n===e)return!0;let t=Ut(n);if(t!==Ut(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return wr(n).isEqual(wr(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=rt(i.timestampValue),c=rt(o.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return Et(i.bytesValue).isEqual(Et(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return ee(i.geoPointValue.latitude)===ee(o.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return ee(i.integerValue)===ee(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=ee(i.doubleValue),c=ee(o.doubleValue);return a===c?Er(a)===Er(c):isNaN(a)&&isNaN(c)}return!1}(n,e);case 9:return fn(n.arrayValue.values||[],e.arrayValue.values||[],qe);case 10:case 11:return function(i,o){let a=i.mapValue.fields||{},c=o.mapValue.fields||{};if(Qh(a)!==Qh(c))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(c[h]===void 0||!qe(a[h],c[h])))return!1;return!0}(n,e);default:return U()}}function Ir(n,e){return(n.values||[]).find(t=>qe(t,e))!==void 0}function pn(n,e){if(n===e)return 0;let t=Ut(n),r=Ut(e);if(t!==r)return H(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return H(n.booleanValue,e.booleanValue);case 2:return function(o,a){let c=ee(o.integerValue||o.doubleValue),h=ee(a.integerValue||a.doubleValue);return c<h?-1:c>h?1:c===h?0:isNaN(c)?isNaN(h)?0:-1:1}(n,e);case 3:return Yh(n.timestampValue,e.timestampValue);case 4:return Yh(wr(n),wr(e));case 5:return H(n.stringValue,e.stringValue);case 6:return function(o,a){let c=Et(o),h=Et(a);return c.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){let c=o.split("/"),h=a.split("/");for(let d=0;d<c.length&&d<h.length;d++){let p=H(c[d],h[d]);if(p!==0)return p}return H(c.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){let c=H(ee(o.latitude),ee(a.latitude));return c!==0?c:H(ee(o.longitude),ee(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Jh(n.arrayValue,e.arrayValue);case 10:return function(o,a){var c,h,d,p;let v=o.fields||{},A=a.fields||{},S=(c=v.value)===null||c===void 0?void 0:c.arrayValue,k=(h=A.value)===null||h===void 0?void 0:h.arrayValue,P=H(((d=S?.values)===null||d===void 0?void 0:d.length)||0,((p=k?.values)===null||p===void 0?void 0:p.length)||0);return P!==0?P:Jh(S,k)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===ki.mapValue&&a===ki.mapValue)return 0;if(o===ki.mapValue)return 1;if(a===ki.mapValue)return-1;let c=o.fields||{},h=Object.keys(c),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let v=0;v<h.length&&v<p.length;++v){let A=H(h[v],p[v]);if(A!==0)return A;let S=pn(c[h[v]],d[p[v]]);if(S!==0)return S}return H(h.length,p.length)}(n.mapValue,e.mapValue);default:throw U()}}function Yh(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return H(n,e);let t=rt(n),r=rt(e),i=H(t.seconds,r.seconds);return i!==0?i:H(t.nanos,r.nanos)}function Jh(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=pn(t[i],r[i]);if(o)return o}return H(t.length,r.length)}function mn(n){return Ta(n)}function Ta(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=rt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Et(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return M.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=Ta(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${Ta(t.fields[a])}`;return i+"}"}(n.mapValue):U()}function Xh(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Aa(n){return!!n&&"integerValue"in n}function Xu(n){return!!n&&"arrayValue"in n}function Zh(n){return!!n&&"nullValue"in n}function ed(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Fi(n){return!!n&&"mapValue"in n}function kd(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function mr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Gt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=mr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=mr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Od(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Re=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Fi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=mr(t)}setAll(e){let t=Pe.emptyPath(),r={},i=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=c.popLast()}a?r[c.lastSegment()]=mr(a):i.push(c.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());Fi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Fi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Gt(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(mr(this.value))}};function Fd(n){let e=[];return Gt(n.fields,(t,r)=>{let i=new Pe([t]);if(Fi(r)){let o=Fd(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Fe(e)}var Me=class n{constructor(e,t,r,i,o,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=c}static newInvalidDocument(e){return new n(e,0,j.min(),j.min(),j.min(),Re.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,j.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,j.min(),j.min(),Re.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,j.min(),j.min(),Re.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Re.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Re.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var gn=class{constructor(e,t){this.position=e,this.inclusive=t}};function td(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),t.key):r=pn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function nd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qe(n.position[t],e.position[t]))return!1;return!0}var Bt=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function T_(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ji=class{},ue=class n extends ji{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new ba(e,t,r):t==="array-contains"?new Ra(e,r):t==="in"?new Pa(e,r):t==="not-in"?new Na(e,r):t==="array-contains-any"?new ka(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Sa(e,r):new Ca(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(pn(t,this.value)):t!==null&&Ut(this.value)===Ut(t)&&this.matchesComparison(pn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ve=class n extends ji{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return xd(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function xd(n){return n.op==="and"}function Ld(n){return A_(n)&&xd(n)}function A_(n){for(let e of n.filters)if(e instanceof Ve)return!1;return!0}function Da(n){if(n instanceof ue)return n.field.canonicalString()+n.op.toString()+mn(n.value);if(Ld(n))return n.filters.map(e=>Da(e)).join(",");{let e=n.filters.map(t=>Da(t)).join(",");return`${n.op}(${e})`}}function Md(n,e){return n instanceof ue?function(r,i){return i instanceof ue&&r.op===i.op&&r.field.isEqual(i.field)&&qe(r.value,i.value)}(n,e):n instanceof Ve?function(r,i){return i instanceof Ve&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,c)=>o&&Md(a,i.filters[c]),!0):!1}(n,e):void U()}function Vd(n){return n instanceof ue?function(t){return`${t.field.canonicalString()} ${t.op} ${mn(t.value)}`}(n):n instanceof Ve?function(t){return t.op.toString()+" {"+t.getFilters().map(Vd).join(" ,")+"}"}(n):"Filter"}var ba=class extends ue{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){let t=M.comparator(e.key,this.key);return this.matchesComparison(t)}},Sa=class extends ue{constructor(e,t){super(e,"in",t),this.keys=Ud("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Ca=class extends ue{constructor(e,t){super(e,"not-in",t),this.keys=Ud("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Ud(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}var Ra=class extends ue{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Xu(t)&&Ir(t.arrayValue,this.value)}},Pa=class extends ue{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ir(this.value.arrayValue,t)}},Na=class extends ue{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ir(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ir(this.value.arrayValue,t)}},ka=class extends ue{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Xu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ir(this.value.arrayValue,r))}};var Oa=class{constructor(e,t=null,r=[],i=[],o=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=c,this.ue=null}};function rd(n,e=null,t=[],r=[],i=null,o=null,a=null){return new Oa(n,e,t,r,i,o,a)}function Zu(n){let e=B(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Da(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),fs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>mn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>mn(r)).join(",")),e.ue=t}return e.ue}function ec(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!T_(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Md(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!nd(n.startAt,e.startAt)&&nd(n.endAt,e.endAt)}function Fa(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var wt=class{constructor(e,t=null,r=[],i=[],o=null,a="F",c=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=c,this.endAt=h,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function D_(n,e,t,r,i,o,a,c){return new wt(n,e,t,r,i,o,a,c)}function tc(n){return new wt(n)}function id(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Bd(n){return n.collectionGroup!==null}function gr(n){let e=B(n);if(e.ce===null){e.ce=[];let t=new Set;for(let o of e.explicitOrderBy)e.ce.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new we(Pe.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.ce.push(new Bt(o,r))}),t.has(Pe.keyField().canonicalString())||e.ce.push(new Bt(Pe.keyField(),r))}return e.ce}function je(n){let e=B(n);return e.le||(e.le=b_(e,gr(n))),e.le}function b_(n,e){if(n.limitType==="F")return rd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new Bt(i.field,o)});let t=n.endAt?new gn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new gn(n.startAt.position,n.startAt.inclusive):null;return rd(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function xa(n,e){let t=n.filters.concat([e]);return new wt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function La(n,e,t){return new wt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ps(n,e){return ec(je(n),je(e))&&n.limitType===e.limitType}function $d(n){return`${Zu(je(n))}|lt:${n.limitType}`}function on(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Vd(i)).join(", ")}]`),fs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>mn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>mn(i)).join(",")),`Target(${r})`}(je(n))}; limitType=${n.limitType})`}function ms(n,e){return e.isFoundDocument()&&function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(let o of gr(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,c,h){let d=td(a,c,h);return a.inclusive?d<=0:d<0}(r.startAt,gr(r),i)||r.endAt&&!function(a,c,h){let d=td(a,c,h);return a.inclusive?d>=0:d>0}(r.endAt,gr(r),i))}(n,e)}function S_(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function jd(n){return(e,t)=>{let r=!1;for(let i of gr(n)){let o=C_(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function C_(n,e,t){let r=n.field.isKeyField()?M.comparator(e.key,t.key):function(o,a,c){let h=a.data.field(o),d=c.data.field(o);return h!==null&&d!==null?pn(h,d):U()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U()}}var It=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Gt(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return Nd(this.inner)}size(){return this.innerSize}};var R_=new ie(M.comparator);function it(){return R_}var zd=new ie(M.comparator);function pr(...n){let e=zd;for(let t of n)e=e.insert(t.key,t);return e}function qd(n){let e=zd;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ft(){return yr()}function Gd(){return yr()}function yr(){return new It(n=>n.toString(),(n,e)=>n.isEqual(e))}var P_=new ie(M.comparator),N_=new we(M.comparator);function q(...n){let e=N_;for(let t of n)e=e.add(t);return e}var k_=new we(H);function O_(){return k_}function nc(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Er(e)?"-0":e}}function Wd(n){return{integerValue:""+n}}function F_(n,e){return y_(e)?Wd(e):nc(n,e)}var yn=class{constructor(){this._=void 0}};function x_(n,e,t){return n instanceof _n?function(i,o){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&Yu(o)&&(o=Ju(o)),o&&(a.fields.__previous_value__=o),{mapValue:a}}(t,e):n instanceof $t?Hd(n,e):n instanceof jt?Qd(n,e):function(i,o){let a=Kd(i,o),c=sd(a)+sd(i.Pe);return Aa(a)&&Aa(i.Pe)?Wd(c):nc(i.serializer,c)}(n,e)}function L_(n,e,t){return n instanceof $t?Hd(n,e):n instanceof jt?Qd(n,e):t}function Kd(n,e){return n instanceof vn?function(r){return Aa(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}var _n=class extends yn{},$t=class extends yn{constructor(e){super(),this.elements=e}};function Hd(n,e){let t=Yd(e);for(let r of n.elements)t.some(i=>qe(i,r))||t.push(r);return{arrayValue:{values:t}}}var jt=class extends yn{constructor(e){super(),this.elements=e}};function Qd(n,e){let t=Yd(e);for(let r of n.elements)t=t.filter(i=>!qe(i,r));return{arrayValue:{values:t}}}var vn=class extends yn{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function sd(n){return ee(n.integerValue||n.doubleValue)}function Yd(n){return Xu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function M_(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof $t&&i instanceof $t||r instanceof jt&&i instanceof jt?fn(r.elements,i.elements,qe):r instanceof vn&&i instanceof vn?qe(r.Pe,i.Pe):r instanceof _n&&i instanceof _n}(n.transform,e.transform)}var Ma=class{constructor(e,t){this.version=e,this.transformResults=t}},tt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function xi(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var En=class{};function Jd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Tr(n.key,tt.none()):new zt(n.key,n.data,tt.none());{let t=n.data,r=Re.empty(),i=new we(Pe.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new Ge(n.key,r,new Fe(i.toArray()),tt.none())}}function V_(n,e,t){n instanceof zt?function(i,o,a){let c=i.value.clone(),h=ad(i.fieldTransforms,o,a.transformResults);c.setAll(h),o.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):n instanceof Ge?function(i,o,a){if(!xi(i.precondition,o))return void o.convertToUnknownDocument(a.version);let c=ad(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Xd(i)),h.setAll(c),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function _r(n,e,t,r){return n instanceof zt?function(o,a,c,h){if(!xi(o.precondition,a))return c;let d=o.value.clone(),p=ud(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ge?function(o,a,c,h){if(!xi(o.precondition,a))return c;let d=ud(o.fieldTransforms,h,a),p=a.data;return p.setAll(Xd(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),c===null?null:c.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(v=>v.field))}(n,e,t,r):function(o,a,c){return xi(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(n,e,t)}function U_(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=Kd(r.transform,i||null);o!=null&&(t===null&&(t=Re.empty()),t.set(r.field,o))}return t||null}function od(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&fn(r,i,(o,a)=>M_(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var zt=class extends En{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ge=class extends En{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Xd(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function ad(n,e,t){let r=new Map;J(n.length===t.length);for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,c=e.data.field(o.field);r.set(o.field,L_(a,c,t[i]))}return r}function ud(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,x_(o,a,e))}return r}var Tr=class extends En{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Va=class extends En{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ua=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&V_(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=_r(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=_r(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Gd();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,c=this.applyToLocalView(a,o.mutatedFields);c=t.has(i.key)?null:c;let h=Jd(a,c);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(j.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),q())}isEqual(e){return this.batchId===e.batchId&&fn(this.mutations,e.mutations,(t,r)=>od(t,r))&&fn(this.baseMutations,e.baseMutations,(t,r)=>od(t,r))}},Ba=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){J(e.mutations.length===r.length);let i=function(){return P_}(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var $a=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ja=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var oe,W;function B_(n){switch(n){default:return U();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function Zd(n){if(n===void 0)return nt("GRPC error has no .code"),C.UNKNOWN;switch(n){case oe.OK:return C.OK;case oe.CANCELLED:return C.CANCELLED;case oe.UNKNOWN:return C.UNKNOWN;case oe.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case oe.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case oe.INTERNAL:return C.INTERNAL;case oe.UNAVAILABLE:return C.UNAVAILABLE;case oe.UNAUTHENTICATED:return C.UNAUTHENTICATED;case oe.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case oe.NOT_FOUND:return C.NOT_FOUND;case oe.ALREADY_EXISTS:return C.ALREADY_EXISTS;case oe.PERMISSION_DENIED:return C.PERMISSION_DENIED;case oe.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case oe.ABORTED:return C.ABORTED;case oe.OUT_OF_RANGE:return C.OUT_OF_RANGE;case oe.UNIMPLEMENTED:return C.UNIMPLEMENTED;case oe.DATA_LOSS:return C.DATA_LOSS;default:return U()}}(W=oe||(oe={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";var cd=null;function $_(){return new TextEncoder}var j_=new _t([4294967295,4294967295],0);function ld(n){let e=$_().encode(n),t=new na;return t.update(e),new Uint8Array(t.digest())}function hd(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new _t([t,r],0),new _t([i,o],0)]}var za=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new xt(`Invalid padding: ${t}`);if(r<0)throw new xt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new xt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new xt(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=_t.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(_t.fromNumber(r)));return i.compare(j_)===1&&(i=new _t([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=ld(e),[r,i]=hd(t);for(let o=0;o<this.hashCount;o++){let a=this.Ee(r,i,o);if(!this.de(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(c=>a.insert(c)),a}insert(e){if(this.Ie===0)return;let t=ld(e),[r,i]=hd(t);for(let o=0;o<this.hashCount;o++){let a=this.Ee(r,i,o);this.Ae(a)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},xt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var zi=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Ar.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(j.min(),i,new ie(H),it(),q())}},Ar=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,q(),q(),q())}};var ln=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},qi=class{constructor(e,t){this.targetId=e,this.me=t}},Gi=class{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Wi=class{constructor(){this.fe=0,this.ge=fd(),this.pe=Ie.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=q(),t=q(),r=q();return this.ge.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:U()}}),new Ar(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=fd()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,J(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},qa=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=it(),this.qe=dd(),this.Qe=new ie(H)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let o=i.target;if(Fa(o))if(r===0){let a=new M(o.path);this.Ue(t,a,Me.newNoDocument(a,j.min()))}else J(r===1);else{let a=this.Ye(t);if(a!==r){let c=this.Ze(e),h=c?this.Xe(c,e,a):1;if(h!==0){this.je(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}cd?.et(function(p,v,A,S,k){var P,R,V,$,L,Q;let te={localCacheCount:p,existenceFilterCount:v.count,databaseId:A.database,projectId:A.projectId},G=v.unchangedNames;return G&&(te.bloomFilter={applied:k===0,hashCount:(P=G?.hashCount)!==null&&P!==void 0?P:0,bitmapLength:($=(V=(R=G?.bits)===null||R===void 0?void 0:R.bitmap)===null||V===void 0?void 0:V.length)!==null&&$!==void 0?$:0,padding:(Q=(L=G?.bits)===null||L===void 0?void 0:L.padding)!==null&&Q!==void 0?Q:0,mightContain:E=>{var m;return(m=S?.mightContain(E))!==null&&m!==void 0&&m}}),te}(a,e.me,this.Le.tt(),c,h))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,c;try{a=Et(r).toUint8Array()}catch(h){if(h instanceof Bi)return dn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{c=new za(a,i,o)}catch(h){return dn(h instanceof xt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return c.Ie===0?null:c}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.Le.tt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,o,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((o,a)=>{let c=this.Je(a);if(c){if(o.current&&Fa(c.target)){let h=new M(c.target.path);this.ke.get(h)!==null||this.it(a,h)||this.Ue(a,h,Me.newNoDocument(h,e))}o.be&&(t.set(a,o.ve()),o.Ce())}});let r=q();this.qe.forEach((o,a)=>{let c=!0;a.forEachWhile(h=>{let d=this.Je(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(o))}),this.ke.forEach((o,a)=>a.setReadTime(e));let i=new zi(e,t,this.Qe,this.ke,r);return this.ke=it(),this.qe=dd(),this.Qe=new ie(H),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Wi,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new we(H),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Wi),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function dd(){return new ie(M.comparator)}function fd(){return new ie(M.comparator)}var z_={asc:"ASCENDING",desc:"DESCENDING"},q_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},G_={and:"AND",or:"OR"},Ga=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Wa(n,e){return n.useProto3Json||fs(e)?e:{value:e}}function Ki(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ef(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function W_(n,e){return Ki(n,e.toTimestamp())}function ze(n){return J(!!n),j.fromTimestamp(function(t){let r=rt(t);return new pe(r.seconds,r.nanos)}(n))}function rc(n,e){return Ka(n,e).canonicalString()}function Ka(n,e){let t=function(i){return new ne(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function tf(n){let e=ne.fromString(n);return J(af(e)),e}function Ha(n,e){return rc(n.databaseId,e.path)}function ua(n,e){let t=tf(e);if(t.get(1)!==n.databaseId.projectId)throw new F(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new F(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(rf(t))}function nf(n,e){return rc(n.databaseId,e)}function K_(n){let e=tf(n);return e.length===4?ne.emptyPath():rf(e)}function Qa(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function rf(n){return J(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function pd(n,e,t){return{name:Ha(n,e),fields:t.value.mapValue.fields}}function H_(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:U()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(d,p){return d.useProto3Json?(J(p===void 0||typeof p=="string"),Ie.fromBase64String(p||"")):(J(p===void 0||p instanceof Buffer||p instanceof Uint8Array),Ie.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(d){let p=d.code===void 0?C.UNKNOWN:Zd(d.code);return new F(p,d.message||"")}(a);t=new Gi(r,i,o,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=ua(n,r.document.name),o=ze(r.document.updateTime),a=r.document.createTime?ze(r.document.createTime):j.min(),c=new Re({mapValue:{fields:r.document.fields}}),h=Me.newFoundDocument(i,o,a,c),d=r.targetIds||[],p=r.removedTargetIds||[];t=new ln(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=ua(n,r.document),o=r.readTime?ze(r.readTime):j.min(),a=Me.newNoDocument(i,o),c=r.removedTargetIds||[];t=new ln([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=ua(n,r.document),o=r.removedTargetIds||[];t=new ln([],o,i,null)}else{if(!("filter"in e))return U();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new ja(i,o),c=r.targetId;t=new qi(c,a)}}return t}function Q_(n,e){let t;if(e instanceof zt)t={update:pd(n,e.key,e.value)};else if(e instanceof Tr)t={delete:Ha(n,e.key)};else if(e instanceof Ge)t={update:pd(n,e.key,e.data),updateMask:iv(e.fieldMask)};else{if(!(e instanceof Va))return U();t={verify:Ha(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){let c=a.transform;if(c instanceof _n)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof $t)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof jt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof vn)return{fieldPath:a.field.canonicalString(),increment:c.Pe};throw U()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:W_(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:U()}(n,e.precondition)),t}function Y_(n,e){return n&&n.length>0?(J(e!==void 0),n.map(t=>function(i,o){let a=i.updateTime?ze(i.updateTime):ze(o);return a.isEqual(j.min())&&(a=ze(o)),new Ma(a,i.transformResults||[])}(t,e))):[]}function J_(n,e){return{documents:[nf(n,e.path)]}}function X_(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=nf(n,i);let o=function(d){if(d.length!==0)return of(Ve.create(d,"and"))}(e.filters);o&&(t.structuredQuery.where=o);let a=function(d){if(d.length!==0)return d.map(p=>function(A){return{field:an(A.field),direction:tv(A.dir)}}(p))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let c=Wa(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:i}}function Z_(n){let e=K_(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){J(r===1);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=function(v){let A=sf(v);return A instanceof Ve&&Ld(A)?A.getFilters():[A]}(t.where));let a=[];t.orderBy&&(a=function(v){return v.map(A=>function(k){return new Bt(un(k.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(A))}(t.orderBy));let c=null;t.limit&&(c=function(v){let A;return A=typeof v=="object"?v.value:v,fs(A)?null:A}(t.limit));let h=null;t.startAt&&(h=function(v){let A=!!v.before,S=v.values||[];return new gn(S,A)}(t.startAt));let d=null;return t.endAt&&(d=function(v){let A=!v.before,S=v.values||[];return new gn(S,A)}(t.endAt)),D_(e,i,a,o,c,"F",h,d)}function ev(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function sf(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=un(t.unaryFilter.field);return ue.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=un(t.unaryFilter.field);return ue.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=un(t.unaryFilter.field);return ue.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=un(t.unaryFilter.field);return ue.create(a,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):n.fieldFilter!==void 0?function(t){return ue.create(un(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ve.create(t.compositeFilter.filters.map(r=>sf(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(n):U()}function tv(n){return z_[n]}function nv(n){return q_[n]}function rv(n){return G_[n]}function an(n){return{fieldPath:n.canonicalString()}}function un(n){return Pe.fromServerFormat(n.fieldPath)}function of(n){return n instanceof ue?function(t){if(t.op==="=="){if(ed(t.value))return{unaryFilter:{field:an(t.field),op:"IS_NAN"}};if(Zh(t.value))return{unaryFilter:{field:an(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ed(t.value))return{unaryFilter:{field:an(t.field),op:"IS_NOT_NAN"}};if(Zh(t.value))return{unaryFilter:{field:an(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:an(t.field),op:nv(t.op),value:t.value}}}(n):n instanceof Ve?function(t){let r=t.getFilters().map(i=>of(i));return r.length===1?r[0]:{compositeFilter:{op:rv(t.op),filters:r}}}(n):U()}function iv(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function af(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Dr=class n{constructor(e,t,r,i,o=j.min(),a=j.min(),c=Ie.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ya=class{constructor(e){this.ct=e}};function sv(n){let e=Z_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?La(e,e.limit,"L"):e}var Hi=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ee(e.integerValue));else if("doubleValue"in e){let r=ee(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Er(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=rt(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Et(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Od(e)?this.dt(t,Number.MAX_SAFE_INTEGER):kd(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):U()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let o=e.fields||{};this.dt(t,53);let a="value",c=((i=(r=o[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(ee(c)),this.Vt(a,t),this.Tt(o[a],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),M.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Hi.vt=new Hi;var Ja=class{constructor(){this.un=new Xa}addToCollectionParentIndex(e,t){return this.un.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(Vt.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(Vt.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}},Xa=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new we(ne.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new we(ne.comparator)).toArray()}};var S0=new Uint8Array(0);var Be=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Be.DEFAULT_COLLECTION_PERCENTILE=10,Be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Be.DEFAULT=new Be(41943040,Be.DEFAULT_COLLECTION_PERCENTILE,Be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Be.DISABLED=new Be(-1,0,0);var br=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var Za=class{constructor(){this.changes=new It(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var eu=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var tu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&_r(r.mutation,i,Fe.empty(),pe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=q()){let i=Ft();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=pr();return o.forEach((c,h)=>{a=a.insert(c,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Ft();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,q()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,r,i){let o=it(),a=yr(),c=function(){return yr()}();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof Ge)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),_r(p.mutation,d,p.mutation.getFieldMask(),pe.now())):a.set(d.key,Fe.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>{var v;return c.set(d,new eu(p,(v=a.get(d))!==null&&v!==void 0?v:null))}),c))}recalculateAndSaveOverlays(e,t){let r=yr(),i=new ie((a,c)=>a-c),o=q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let c of a)c.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||Fe.empty();p=c.applyToLocalView(d,p),r.set(h,p);let v=(i.get(c.batchId)||q()).add(h);i=i.insert(c.batchId,v)})}).next(()=>{let a=[],c=i.getReverseIterator();for(;c.hasNext();){let h=c.getNext(),d=h.key,p=h.value,v=Gd();p.forEach(A=>{if(!o.has(A)){let S=Jd(t.get(A),r.get(A));S!==null&&v.set(A,S),o=o.add(A)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,v))}return N.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Bd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):N.resolve(Ft()),c=-1,h=o;return a.next(d=>N.forEach(d,(p,v)=>(c<v.largestBatchId&&(c=v.largestBatchId),o.get(p)?N.resolve():this.remoteDocumentCache.getEntry(e,p).next(A=>{h=h.insert(p,A)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,h,d,q())).next(p=>({batchId:c,changes:qd(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=pr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=pr();return this.indexManager.getCollectionParents(e,o).next(c=>N.forEach(c,h=>{let d=function(v,A){return new wt(A,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((v,A)=>{a=a.insert(v,A)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,Me.newInvalidDocument(p)))});let c=pr();return a.forEach((h,d)=>{let p=o.get(h);p!==void 0&&_r(p.mutation,d,Fe.empty(),pe.now()),ms(t,d)&&(c=c.insert(h,d))}),c})}};var nu=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return N.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ze(i.createTime)}}(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:sv(i.bundledQuery),readTime:ze(i.readTime)}}(t)),N.resolve()}};var ru=class{constructor(){this.overlays=new ie(M.comparator),this.Ir=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Ft();return N.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.ht(e,t,o)}),N.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Ir.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){let i=Ft(),o=t.length+1,a=new M(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){let h=c.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return N.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ie((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Ft(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let c=Ft(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>c.set(d,p)),!(c.size()>=i)););return N.resolve(c)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new $a(t,r));let o=this.Ir.get(t);o===void 0&&(o=q(),this.Ir.set(t,o)),this.Ir.set(t,o.add(r.key))}};var iu=class{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}};var Sr=class{constructor(){this.Tr=new we(ae.Er),this.dr=new we(ae.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new ae(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new ae(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new M(new ne([])),r=new ae(t,e),i=new ae(t,e+1),o=[];return this.dr.forEachInRange([r,i],a=>{this.Vr(a),o.push(a.key)}),o}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new M(new ne([])),r=new ae(t,e),i=new ae(t,e+1),o=q();return this.dr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new ae(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ae=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return M.comparator(e.key,t.key)||H(e.wr,t.wr)}static Ar(e,t){return H(e.wr,t.wr)||M.comparator(e.key,t.key)}};var su=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new we(ae.Er)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ua(o,t,r,i);this.mutationQueue.push(a);for(let c of i)this.br=this.br.add(new ae(c.key,o)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return N.resolve(a)}lookupMutationBatch(e,t){return N.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),o=i<0?0:i;return N.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ae(t,0),i=new ae(t,Number.POSITIVE_INFINITY),o=[];return this.br.forEachInRange([r,i],a=>{let c=this.Dr(a.wr);o.push(c)}),N.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new we(H);return t.forEach(i=>{let o=new ae(i,0),a=new ae(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([o,a],c=>{r=r.add(c.wr)})}),N.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;M.isDocumentKey(o)||(o=o.child(""));let a=new ae(new M(o),0),c=new we(H);return this.br.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(c=c.add(h.wr)),!0)},a),N.resolve(this.Cr(c))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){J(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return N.forEach(t.mutations,i=>{let o=new ae(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new ae(t,0),i=this.br.firstAfterOrEqual(r);return N.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var ou=class{constructor(e){this.Mr=e,this.docs=function(){return new ie(M.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let r=it();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Me.newInvalidDocument(i))}),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=it(),a=t.path,c=new M(a.child("")),h=this.docs.getIteratorFrom(c);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||p_(f_(p),r)<=0||(i.has(p.key)||ms(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return N.resolve(o)}getAllFromCollectionGroup(e,t,r,i){U()}Or(e,t){return N.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new au(this)}getSize(e){return N.resolve(this.size)}},au=class extends Za{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),N.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var uu=class{constructor(e){this.persistence=e,this.Nr=new It(t=>Zu(t),ec),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Sr,this.targetCount=0,this.kr=br.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),N.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new br(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.Kn(t),N.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.Nr.forEach((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.Nr.delete(a),o.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),N.waitFor(o).next(()=>i)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),N.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),N.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),N.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this.Br.containsKey(t))}};var cu=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Pd(0),this.Kr=!1,this.Kr=!0,this.$r=new iu,this.referenceDelegate=e(this),this.Ur=new uu(this),this.indexManager=new Ja,this.remoteDocumentCache=function(i){return new ou(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Ya(t),this.Gr=new nu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ru,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new su(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);let i=new lu(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(o=>this.referenceDelegate.jr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Hr(e,t){return N.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},lu=class extends wa{constructor(e){super(),this.currentSequenceNumber=e}},hu=class n{constructor(e){this.persistence=e,this.Jr=new Sr,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw U()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),N.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.Xr.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.Xr,r=>{let i=M.fromPath(r);return this.ei(e,i).next(o=>{o||t.removeEntry(i,j.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return N.or([()=>N.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var du=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=q(),i=q();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var fu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var pu=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return hh()?8:g_(Ce())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.Yi(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.Zi(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new fu;return this.Xi(e,t,a).next(c=>{if(o.result=c,this.zi)return this.es(e,t,a,c.size)})}).next(()=>o.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(fr()<=z.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",on(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),N.resolve()):(fr()<=z.DEBUG&&x("QueryEngine","Query:",on(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(fr()<=z.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",on(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,je(t))):N.resolve())}Yi(e,t){if(id(t))return N.resolve(null);let r=je(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=La(t,null,"F"),r=je(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=q(...o);return this.Ji.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.ts(t,c);return this.ns(t,d,a,h.readTime)?this.Yi(e,La(t,null,"F")):this.rs(e,d,t,h)}))})))}Zi(e,t,r,i){return id(t)||i.isEqual(j.min())?N.resolve(null):this.Ji.getDocuments(e,r).next(o=>{let a=this.ts(t,o);return this.ns(t,a,r,i)?N.resolve(null):(fr()<=z.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),on(t)),this.rs(e,a,t,d_(i,-1)).next(c=>c))})}ts(e,t){let r=new we(jd(e));return t.forEach((i,o)=>{ms(e,o)&&(r=r.add(o))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Xi(e,t,r){return fr()<=z.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",on(t)),this.Ji.getDocumentsMatchingQuery(e,t,Vt.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var mu=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new ie(H),this._s=new It(o=>Zu(o),ec),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tu(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function ov(n,e,t,r){return new mu(n,e,t,r)}function uf(n,e){return D(this,null,function*(){let t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],c=[],h=q();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of o){c.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:c}))})})})}function av(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,h,d,p){let v=d.batch,A=v.keys(),S=N.resolve();return A.forEach(k=>{S=S.next(()=>p.getEntry(h,k)).next(P=>{let R=d.docVersions.get(k);J(R!==null),P.version.compareTo(R)<0&&(v.applyToRemoteDocument(P,d),P.isValidDocument()&&(P.setReadTime(d.commitVersion),p.addEntry(P)))})}),S.next(()=>c.mutationQueue.removeMutationBatch(h,v))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let h=q();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(h=h.add(c.batch.mutations[d].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function cf(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function uv(n,e){let t=B(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let c=[];e.targetChanges.forEach((p,v)=>{let A=i.get(v);if(!A)return;c.push(t.Ur.removeMatchingKeys(o,p.removedDocuments,v).next(()=>t.Ur.addMatchingKeys(o,p.addedDocuments,v)));let S=A.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(v)!==null?S=S.withResumeToken(Ie.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):p.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(p.resumeToken,r)),i=i.insert(v,S),function(P,R,V){return P.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=3e8?!0:V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0}(A,S,p)&&c.push(t.Ur.updateTargetData(o,S))});let h=it(),d=q();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),c.push(cv(o,a,e.documentUpdates).next(p=>{h=p.Ps,d=p.Is})),!r.isEqual(j.min())){let p=t.Ur.getLastRemoteSnapshotVersion(o).next(v=>t.Ur.setTargetsMetadata(o,o.currentSequenceNumber,r));c.push(p)}return N.waitFor(c).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,d)).next(()=>h)}).then(o=>(t.os=i,o))}function cv(n,e,t){let r=q(),i=q();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=it();return t.forEach((c,h)=>{let d=o.get(c);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(c)),h.isNoDocument()&&h.version.isEqual(j.min())?(e.removeEntry(c,h.readTime),a=a.insert(c,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(c,h)):x("LocalStore","Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",h.version)}),{Ps:a,Is:i}})}function lv(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function hv(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(o=>o?(i=o,N.resolve(i)):t.Ur.allocateTargetId(r).next(a=>(i=new Dr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function gu(n,e,t){return D(this,null,function*(){let r=B(n),i=r.os.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Fr(a))throw a;x("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function md(n,e,t){let r=B(n),i=j.min(),o=q();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,d,p){let v=B(h),A=v._s.get(p);return A!==void 0?N.resolve(v.os.get(A)):v.Ur.getTargetData(d,p)}(r,a,je(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,c.targetId).next(h=>{o=h})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,t?i:j.min(),t?o:q())).next(c=>(dv(r,S_(e),c),{documents:c,Ts:o})))}function dv(n,e,t){let r=n.us.get(e)||j.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.us.set(e,r)}var Qi=class{constructor(){this.activeTargetIds=O_()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var yu=class{constructor(){this.so=new Qi,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Qi,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var _u=class{_o(e){}shutdown(){}};var Yi=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){x("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){x("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Oi=null;function ca(){return Oi===null?Oi=function(){return 268435456+Math.round(2147483648*Math.random())}():Oi++,"0x"+Oi.toString(16)}var fv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var vu=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Ee="WebChannelConnection",Eu=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${o}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${o}`}get Fo(){return!1}Mo(t,r,i,o,a){let c=ca(),h=this.xo(t,r.toUriEncodedString());x("RestConnection",`Sending RPC '${t}' ${c}:`,h,i);let d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,o,a),this.No(t,h,d,i).then(p=>(x("RestConnection",`Received RPC '${t}' ${c}: `,p),p),p=>{throw dn("RestConnection",`RPC '${t}' ${c} failed with error: `,p,"url: ",h,"request:",i),p})}Lo(t,r,i,o,a,c){return this.Mo(t,r,i,o,a)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Dn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((o,a)=>t[a]=o),i&&i.headers.forEach((o,a)=>t[a]=o)}xo(t,r){let i=fv[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let o=ca();return new Promise((a,c)=>{let h=new ra;h.setWithCredentials(!0),h.listenOnce(ia.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case dr.NO_ERROR:let p=h.getResponseJson();x(Ee,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),a(p);break;case dr.TIMEOUT:x(Ee,`RPC '${e}' ${o} timed out`),c(new F(C.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:let v=h.getStatus();if(x(Ee,`RPC '${e}' ${o} failed with status:`,v,"response text:",h.getResponseText()),v>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);let S=A?.error;if(S&&S.status&&S.message){let k=function(R){let V=R.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(V)>=0?V:C.UNKNOWN}(S.status);c(new F(k,S.message))}else c(new F(C.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new F(C.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{x(Ee,`RPC '${e}' ${o} completed.`)}});let d=JSON.stringify(i);x(Ee,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",d,r,15)})}Bo(e,t,r){let i=ca(),o=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=aa(),c=oa(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Oo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let p=o.join("");x(Ee,`Creating RPC '${e}' stream ${i}: ${p}`,h);let v=a.createWebChannel(p,h),A=!1,S=!1,k=new vu({Io:R=>{S?x(Ee,`Not sending because RPC '${e}' stream ${i} is closed:`,R):(A||(x(Ee,`Opening RPC '${e}' stream ${i} transport.`),v.open(),A=!0),x(Ee,`RPC '${e}' stream ${i} sending:`,R),v.send(R))},To:()=>v.close()}),P=(R,V,$)=>{R.listen(V,L=>{try{$(L)}catch(Q){setTimeout(()=>{throw Q},0)}})};return P(v,sn.EventType.OPEN,()=>{S||(x(Ee,`RPC '${e}' stream ${i} transport opened.`),k.yo())}),P(v,sn.EventType.CLOSE,()=>{S||(S=!0,x(Ee,`RPC '${e}' stream ${i} transport closed`),k.So())}),P(v,sn.EventType.ERROR,R=>{S||(S=!0,dn(Ee,`RPC '${e}' stream ${i} transport errored:`,R),k.So(new F(C.UNAVAILABLE,"The operation could not be completed")))}),P(v,sn.EventType.MESSAGE,R=>{var V;if(!S){let $=R.data[0];J(!!$);let L=$,Q=L.error||((V=L[0])===null||V===void 0?void 0:V.error);if(Q){x(Ee,`RPC '${e}' stream ${i} received error:`,Q);let te=Q.status,G=function(y){let _=oe[y];if(_!==void 0)return Zd(_)}(te),E=Q.message;G===void 0&&(G=C.INTERNAL,E="Unknown error status: "+te+" with message "+Q.message),S=!0,k.So(new F(G,E)),v.close()}else x(Ee,`RPC '${e}' stream ${i} received:`,$),k.bo($)}}),P(c,sa.STAT_EVENT,R=>{R.stat===Ni.PROXY?x(Ee,`RPC '${e}' stream ${i} detected buffering proxy`):R.stat===Ni.NOPROXY&&x(Ee,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}};function la(){return typeof document<"u"?document:null}function gs(n){return new Ga(n,!0)}var Ji=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=o,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&x("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Xi=class{constructor(e,t,r,i,o,a,c,h){this.ui=e,this.Ho=r,this.Jo=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ji(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return D(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return D(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return D(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(nt(t.toString()),nt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new F(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>D(this,null,function*(){this.state=0,this.start()}))}I_(e){return x("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(x("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},wu=class extends Xi{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=H_(this.serializer,e),r=function(o){if(!("targetChange"in o))return j.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?j.min():a.readTime?ze(a.readTime):j.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=Qa(this.serializer),t.addTarget=function(o,a){let c,h=a.target;if(c=Fa(h)?{documents:J_(o,h)}:{query:X_(o,h)._t},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=ef(o,a.resumeToken);let d=Wa(o,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(j.min())>0){c.readTime=Ki(o,a.snapshotVersion.toTimestamp());let d=Wa(o,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);let r=ev(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=Qa(this.serializer),t.removeTarget=e,this.a_(t)}},Iu=class extends Xi{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return J(!!e.streamToken),this.lastStreamToken=e.streamToken,J(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){J(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=Y_(e.writeResults,e.commitTime),r=ze(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=Qa(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Q_(this.serializer,r))};this.a_(t)}};var Tu=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new F(C.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(e,Ka(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new F(C.UNKNOWN,o.toString())})}Lo(e,t,r,i,o){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Lo(e,Ka(t,r),i,a,c,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new F(C.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},Au=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(nt(t),this.D_=!1):x("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Du=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=o,this.k_._o(a=>{r.enqueueAndForget(()=>D(this,null,function*(){Wt(this)&&(x("RemoteStore","Restarting streams for network reachability change."),yield function(h){return D(this,null,function*(){let d=B(h);d.L_.add(4),yield xr(d),d.q_.set("Unknown"),d.L_.delete(4),yield ys(d)})}(this))}))}),this.q_=new Au(r,i)}};function ys(n){return D(this,null,function*(){if(Wt(n))for(let e of n.B_)yield e(!0)})}function xr(n){return D(this,null,function*(){for(let e of n.B_)yield e(!1)})}function lf(n,e){let t=B(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),ac(t)?oc(t):bn(t).r_()&&sc(t,e))}function ic(n,e){let t=B(n),r=bn(t);t.N_.delete(e),r.r_()&&hf(t,e),t.N_.size===0&&(r.r_()?r.o_():Wt(t)&&t.q_.set("Unknown"))}function sc(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}bn(n).A_(e)}function hf(n,e){n.Q_.xe(e),bn(n).R_(e)}function oc(n){n.Q_=new qa({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),bn(n).start(),n.q_.v_()}function ac(n){return Wt(n)&&!bn(n).n_()&&n.N_.size>0}function Wt(n){return B(n).L_.size===0}function df(n){n.Q_=void 0}function pv(n){return D(this,null,function*(){n.q_.set("Online")})}function mv(n){return D(this,null,function*(){n.N_.forEach((e,t)=>{sc(n,e)})})}function gv(n,e){return D(this,null,function*(){df(n),ac(n)?(n.q_.M_(e),oc(n)):n.q_.set("Unknown")})}function yv(n,e,t){return D(this,null,function*(){if(n.q_.set("Online"),e instanceof Gi&&e.state===2&&e.cause)try{yield function(i,o){return D(this,null,function*(){let a=o.cause;for(let c of o.targetIds)i.N_.has(c)&&(yield i.remoteSyncer.rejectListen(c,a),i.N_.delete(c),i.Q_.removeTarget(c))})}(n,e)}catch(r){x("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Zi(n,r)}else if(e instanceof ln?n.Q_.Ke(e):e instanceof qi?n.Q_.He(e):n.Q_.We(e),!t.isEqual(j.min()))try{let r=yield cf(n.localStore);t.compareTo(r)>=0&&(yield function(o,a){let c=o.Q_.rt(a);return c.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.N_.get(d);p&&o.N_.set(d,p.withResumeToken(h.resumeToken,a))}}),c.targetMismatches.forEach((h,d)=>{let p=o.N_.get(h);if(!p)return;o.N_.set(h,p.withResumeToken(Ie.EMPTY_BYTE_STRING,p.snapshotVersion)),hf(o,h);let v=new Dr(p.target,h,d,p.sequenceNumber);sc(o,v)}),o.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){x("RemoteStore","Failed to raise snapshot:",r),yield Zi(n,r)}})}function Zi(n,e,t){return D(this,null,function*(){if(!Fr(e))throw e;n.L_.add(1),yield xr(n),n.q_.set("Offline"),t||(t=()=>cf(n.localStore)),n.asyncQueue.enqueueRetryable(()=>D(this,null,function*(){x("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield ys(n)}))})}function ff(n,e){return e().catch(t=>Zi(n,t,e))}function _s(n){return D(this,null,function*(){let e=B(n),t=Tt(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;_v(e);)try{let i=yield lv(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,vv(e,i)}catch(i){yield Zi(e,i)}pf(e)&&mf(e)})}function _v(n){return Wt(n)&&n.O_.length<10}function vv(n,e){n.O_.push(e);let t=Tt(n);t.r_()&&t.V_&&t.m_(e.mutations)}function pf(n){return Wt(n)&&!Tt(n).n_()&&n.O_.length>0}function mf(n){Tt(n).start()}function Ev(n){return D(this,null,function*(){Tt(n).p_()})}function wv(n){return D(this,null,function*(){let e=Tt(n);for(let t of n.O_)e.m_(t.mutations)})}function Iv(n,e,t){return D(this,null,function*(){let r=n.O_.shift(),i=Ba.from(r,e,t);yield ff(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield _s(n)})}function Tv(n,e){return D(this,null,function*(){e&&Tt(n).V_&&(yield function(r,i){return D(this,null,function*(){if(function(a){return B_(a)&&a!==C.ABORTED}(i.code)){let o=r.O_.shift();Tt(r).s_(),yield ff(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield _s(r)}})}(n,e)),pf(n)&&mf(n)})}function gd(n,e){return D(this,null,function*(){let t=B(n);t.asyncQueue.verifyOperationInProgress(),x("RemoteStore","RemoteStore received new credentials");let r=Wt(t);t.L_.add(3),yield xr(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield ys(t)})}function Av(n,e){return D(this,null,function*(){let t=B(n);e?(t.L_.delete(2),yield ys(t)):e||(t.L_.add(2),yield xr(t),t.q_.set("Unknown"))})}function bn(n){return n.K_||(n.K_=function(t,r,i){let o=B(t);return o.w_(),new wu(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Eo:pv.bind(null,n),Ro:mv.bind(null,n),mo:gv.bind(null,n),d_:yv.bind(null,n)}),n.B_.push(e=>D(this,null,function*(){e?(n.K_.s_(),ac(n)?oc(n):n.q_.set("Unknown")):(yield n.K_.stop(),df(n))}))),n.K_}function Tt(n){return n.U_||(n.U_=function(t,r,i){let o=B(t);return o.w_(),new Iu(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Ev.bind(null,n),mo:Tv.bind(null,n),f_:wv.bind(null,n),g_:Iv.bind(null,n)}),n.B_.push(e=>D(this,null,function*(){e?(n.U_.s_(),yield _s(n)):(yield n.U_.stop(),n.O_.length>0&&(x("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var bu=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new et,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,c=new n(e,t,a,i,o);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new F(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function uc(n,e){if(nt("AsyncQueue",`${e}: ${n}`),Fr(n))return new F(C.UNAVAILABLE,`${e}: ${n}`);throw n}var es=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=pr(),this.sortedSet=new ie(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var ts=class{constructor(){this.W_=new ie(M.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):U():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},wn=class n{constructor(e,t,r,i,o,a,c,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new n(e,t,es.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ps(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Su=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Cu=class{constructor(){this.queries=yd(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=B(t),o=i.queries;i.queries=yd(),o.forEach((a,c)=>{for(let h of c.j_)h.onError(r)})})(this,new F(C.ABORTED,"Firestore shutting down"))}};function yd(){return new It(n=>$d(n),ps)}function Dv(n,e){return D(this,null,function*(){let t=B(n),r=3,i=e.query,o=t.queries.get(i);o?!o.H_()&&e.J_()&&(r=2):(o=new Su,r=e.J_()?0:1);try{switch(r){case 0:o.z_=yield t.onListen(i,!0);break;case 1:o.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let c=uc(a,`Initialization of query '${on(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,o),o.j_.push(e),e.Z_(t.onlineState),o.z_&&e.X_(o.z_)&&cc(t)})}function bv(n,e){return D(this,null,function*(){let t=B(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.j_.indexOf(e);a>=0&&(o.j_.splice(a,1),o.j_.length===0?i=e.J_()?0:1:!o.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function Sv(n,e){let t=B(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let c of a.j_)c.X_(i)&&(r=!0);a.z_=i}}r&&cc(t)}function Cv(n,e,t){let r=B(n),i=r.queries.get(e);if(i)for(let o of i.j_)o.onError(t);r.queries.delete(e)}function cc(n){n.Y_.forEach(e=>{e.next()})}var Ru,_d;(_d=Ru||(Ru={})).ea="default",_d.Cache="cache";var Pu=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new wn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=wn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Ru.Cache}};var ns=class{constructor(e){this.key=e}},rs=class{constructor(e){this.key=e}},Nu=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=q(),this.mutatedKeys=q(),this.Aa=jd(e),this.Ra=new es(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new ts,i=t?t.Ra:this.Ra,o=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,v)=>{let A=i.get(p),S=ms(this.query,v)?v:null,k=!!A&&this.mutatedKeys.has(A.key),P=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),R=!1;A&&S?A.data.isEqual(S.data)?k!==P&&(r.track({type:3,doc:S}),R=!0):this.ga(A,S)||(r.track({type:2,doc:S}),R=!0,(h&&this.Aa(S,h)>0||d&&this.Aa(S,d)<0)&&(c=!0)):!A&&S?(r.track({type:0,doc:S}),R=!0):A&&!S&&(r.track({type:1,doc:A}),R=!0,(h||d)&&(c=!0)),R&&(S?(a=a.add(S),o=P?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{Ra:a,fa:r,ns:c,mutatedKeys:o}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let a=e.fa.G_();a.sort((p,v)=>function(S,k){let P=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return P(S)-P(k)}(p.type,v.type)||this.Aa(p.doc,v.doc)),this.pa(r),i=i!=null&&i;let c=t&&!i?this.ya():[],h=this.da.size===0&&this.current&&!i?1:0,d=h!==this.Ea;return this.Ea=h,a.length!==0||d?{snapshot:new wn(this.query,e.Ra,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ts,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=q(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new rs(r))}),this.da.forEach(r=>{e.has(r)||t.push(new ns(r))}),t}ba(e){this.Ta=e.Ts,this.da=q();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return wn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},ku=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Ou=class{constructor(e){this.key=e,this.va=!1}},Fu=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new It(c=>$d(c),ps),this.Ma=new Map,this.xa=new Set,this.Oa=new ie(M.comparator),this.Na=new Map,this.La=new Sr,this.Ba={},this.ka=new Map,this.qa=br.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function Rv(n,e,t=!0){return D(this,null,function*(){let r=wf(n),i,o=r.Fa.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Da()):i=yield gf(r,e,t,!0),i})}function Pv(n,e){return D(this,null,function*(){let t=wf(n);yield gf(t,e,!0,!1)})}function gf(n,e,t,r){return D(this,null,function*(){let i=yield hv(n.localStore,je(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),c;return r&&(c=yield Nv(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&lf(n.remoteStore,i),c})}function Nv(n,e,t,r,i){return D(this,null,function*(){n.Ka=(v,A,S)=>function(P,R,V,$){return D(this,null,function*(){let L=R.view.ma(V);L.ns&&(L=yield md(P.localStore,R.query,!1).then(({documents:E})=>R.view.ma(E,L)));let Q=$&&$.targetChanges.get(R.targetId),te=$&&$.targetMismatches.get(R.targetId)!=null,G=R.view.applyChanges(L,P.isPrimaryClient,Q,te);return Ed(P,R.targetId,G.wa),G.snapshot})}(n,v,A,S);let o=yield md(n.localStore,e,!0),a=new Nu(e,o.Ts),c=a.ma(o.documents),h=Ar.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(c,n.isPrimaryClient,h);Ed(n,t,d.wa);let p=new ku(e,t,a);return n.Fa.set(e,p),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),d.snapshot})}function kv(n,e,t){return D(this,null,function*(){let r=B(n),i=r.Fa.get(e),o=r.Ma.get(i.targetId);if(o.length>1)return r.Ma.set(i.targetId,o.filter(a=>!ps(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield gu(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ic(r.remoteStore,i.targetId),xu(r,i.targetId)}).catch(Or))):(xu(r,i.targetId),yield gu(r.localStore,i.targetId,!0))})}function Ov(n,e){return D(this,null,function*(){let t=B(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ic(t.remoteStore,r.targetId))})}function Fv(n,e,t){return D(this,null,function*(){let r=$v(n);try{let i=yield function(a,c){let h=B(a),d=pe.now(),p=c.reduce((S,k)=>S.add(k.key),q()),v,A;return h.persistence.runTransaction("Locally write mutations","readwrite",S=>{let k=it(),P=q();return h.cs.getEntries(S,p).next(R=>{k=R,k.forEach((V,$)=>{$.isValidDocument()||(P=P.add(V))})}).next(()=>h.localDocuments.getOverlayedDocuments(S,k)).next(R=>{v=R;let V=[];for(let $ of c){let L=U_($,v.get($.key).overlayedDocument);L!=null&&V.push(new Ge($.key,L,Fd(L.value.mapValue),tt.exists(!0)))}return h.mutationQueue.addMutationBatch(S,d,V,c)}).next(R=>{A=R;let V=R.applyToLocalDocumentSet(v,P);return h.documentOverlayCache.saveOverlays(S,R.batchId,V)})}).then(()=>({batchId:A.batchId,changes:qd(v)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,c,h){let d=a.Ba[a.currentUser.toKey()];d||(d=new ie(H)),d=d.insert(c,h),a.Ba[a.currentUser.toKey()]=d}(r,i.batchId,t),yield Lr(r,i.changes),yield _s(r.remoteStore)}catch(i){let o=uc(i,"Failed to persist write");t.reject(o)}})}function yf(n,e){return D(this,null,function*(){let t=B(n);try{let r=yield uv(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Na.get(o);a&&(J(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?J(a.va):i.removedDocuments.size>0&&(J(a.va),a.va=!1))}),yield Lr(t,r,e)}catch(r){yield Or(r)}})}function vd(n,e,t){let r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((o,a)=>{let c=a.view.Z_(e);c.snapshot&&i.push(c.snapshot)}),function(a,c){let h=B(a);h.onlineState=c;let d=!1;h.queries.forEach((p,v)=>{for(let A of v.j_)A.Z_(c)&&(d=!0)}),d&&cc(h)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function xv(n,e,t){return D(this,null,function*(){let r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),o=i&&i.key;if(o){let a=new ie(M.comparator);a=a.insert(o,Me.newNoDocument(o,j.min()));let c=q().add(o),h=new zi(j.min(),new Map,new ie(H),a,c);yield yf(r,h),r.Oa=r.Oa.remove(o),r.Na.delete(e),lc(r)}else yield gu(r.localStore,e,!1).then(()=>xu(r,e,t)).catch(Or)})}function Lv(n,e){return D(this,null,function*(){let t=B(n),r=e.batch.batchId;try{let i=yield av(t.localStore,e);vf(t,r,null),_f(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Lr(t,i)}catch(i){yield Or(i)}})}function Mv(n,e,t){return D(this,null,function*(){let r=B(n);try{let i=yield function(a,c){let h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,c).next(v=>(J(v!==null),p=v.keys(),h.mutationQueue.removeMutationBatch(d,v))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,c)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})}(r.localStore,e);vf(r,e,t),_f(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Lr(r,i)}catch(i){yield Or(i)}})}function _f(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function vf(n,e,t){let r=B(n),i=r.Ba[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function xu(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Ef(n,r)})}function Ef(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(ic(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),lc(n))}function Ed(n,e,t){for(let r of t)r instanceof ns?(n.La.addReference(r.key,e),Vv(n,r)):r instanceof rs?(x("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Ef(n,r.key)):U()}function Vv(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(x("SyncEngine","New document in limbo: "+t),n.xa.add(r),lc(n))}function lc(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new M(ne.fromString(e)),r=n.qa.next();n.Na.set(r,new Ou(t)),n.Oa=n.Oa.insert(t,r),lf(n.remoteStore,new Dr(je(tc(t.path)),r,"TargetPurposeLimboResolution",Pd.oe))}}function Lr(n,e,t){return D(this,null,function*(){let r=B(n),i=[],o=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((c,h)=>{a.push(r.Ka(h,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let v=d?!d.fromCache:(p=t?.targetChanges.get(h.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(h.targetId,v?"current":"not-current")}if(d){i.push(d);let v=du.Wi(h.targetId,d);o.push(v)}}))}),yield Promise.all(a),r.Ca.d_(i),yield function(h,d){return D(this,null,function*(){let p=B(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>N.forEach(d,A=>N.forEach(A.$i,S=>p.persistence.referenceDelegate.addReference(v,A.targetId,S)).next(()=>N.forEach(A.Ui,S=>p.persistence.referenceDelegate.removeReference(v,A.targetId,S)))))}catch(v){if(!Fr(v))throw v;x("LocalStore","Failed to update sequence numbers: "+v)}for(let v of d){let A=v.targetId;if(!v.fromCache){let S=p.os.get(A),k=S.snapshotVersion,P=S.withLastLimboFreeSnapshotVersion(k);p.os=p.os.insert(A,P)}}})}(r.localStore,o))})}function Uv(n,e){return D(this,null,function*(){let t=B(n);if(!t.currentUser.isEqual(e)){x("SyncEngine","User change. New user:",e.toKey());let r=yield uf(t.localStore,e);t.currentUser=e,function(o,a){o.ka.forEach(c=>{c.forEach(h=>{h.reject(new F(C.CANCELLED,a))})}),o.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Lr(t,r.hs)}})}function Bv(n,e){let t=B(n),r=t.Na.get(e);if(r&&r.va)return q().add(r.key);{let i=q(),o=t.Ma.get(e);if(!o)return i;for(let a of o){let c=t.Fa.get(a);i=i.unionWith(c.view.Va)}return i}}function wf(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=yf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Bv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xv.bind(null,e),e.Ca.d_=Sv.bind(null,e.eventManager),e.Ca.$a=Cv.bind(null,e.eventManager),e}function $v(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Lv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Mv.bind(null,e),e}var wd=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return D(this,null,function*(){this.serializer=gs(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,r){return null}Ha(t,r){return null}za(t){return ov(this.persistence,new pu,t.initialUser,this.serializer)}Ga(t){return new cu(hu.Zr,this.serializer)}Wa(t){return new yu}terminate(){return D(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var jv=(()=>{class n{initialize(t,r){return D(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>vd(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Uv.bind(null,this.syncEngine),yield Av(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Cu}()}createDatastore(t){let r=gs(t.databaseInfo.databaseId),i=function(a){return new Eu(a)}(t.databaseInfo);return function(a,c,h,d){return new Tu(a,c,h,d)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,o,a,c,h){return new Du(i,o,a,c,h)}(this.localStore,this.datastore,t.asyncQueue,r=>vd(this.syncEngine,r,0),function(){return Yi.D()?new Yi:new _u}())}createSyncEngine(t,r){return function(o,a,c,h,d,p,v){let A=new Fu(o,a,c,h,d,p);return v&&(A.Qa=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return D(this,null,function*(){var t,r;yield function(o){return D(this,null,function*(){let a=B(o);x("RemoteStore","RemoteStore shutting down."),a.L_.add(5),yield xr(a),a.k_.shutdown(),a.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var Lu=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):nt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Mu=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=he.UNAUTHENTICATED,this.clientId=Mi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>D(this,null,function*(){x("FirestoreClient","Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(x("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new et;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=uc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function ha(n,e){return D(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),x("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>D(this,null,function*(){r.isEqual(i)||(yield uf(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Id(n,e){return D(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield zv(n);x("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>gd(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>gd(e.remoteStore,i)),n._onlineComponents=e})}function zv(n){return D(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ha(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;dn("Error using user provided cache. Falling back to memory cache: "+t),yield ha(n,new wd)}}else x("FirestoreClient","Using default OfflineComponentProvider"),yield ha(n,new wd);return n._offlineComponents})}function If(n){return D(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(x("FirestoreClient","Using user provided OnlineComponentProvider"),yield Id(n,n._uninitializedComponentsProvider._online)):(x("FirestoreClient","Using default OnlineComponentProvider"),yield Id(n,new jv))),n._onlineComponents})}function qv(n){return If(n).then(e=>e.syncEngine)}function Td(n){return D(this,null,function*(){let e=yield If(n),t=e.eventManager;return t.onListen=Rv.bind(null,e.syncEngine),t.onUnlisten=kv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Pv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Ov.bind(null,e.syncEngine),t})}function Tf(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Ad=new Map;function Af(n,e,t){if(!t)throw new F(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Gv(n,e,t,r){if(e===!0&&r===!0)throw new F(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Dd(n){if(!M.isDocumentKey(n))throw new F(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function bd(n){if(M.isDocumentKey(n))throw new F(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vs(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U()}function vr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new F(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=vs(n);throw new F(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var is=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new F(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new F(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Gv("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Tf((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new F(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new F(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new F(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},In=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new is({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new F(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new F(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new is(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new fa;switch(r.type){case"firstParty":return new ya(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new F(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return D(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Ad.get(t);r&&(x("ComponentProvider","Removing Datastore"),Ad.delete(t),r.terminate())}(this),Promise.resolve()}};function Df(n,e,t,r={}){var i;let o=(n=vr(n,In))._getSettings(),a=`${e}:${t}`;if(o.host!=="firestore.googleapis.com"&&o.host!==a&&dn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let c,h;if(typeof r.mockUserToken=="string")c=r.mockUserToken,h=he.MOCK_USER;else{c=oh(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new F(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new he(d)}n._authCredentials=new pa(new Li(c,h))}}var qt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ne=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},vt=class n extends qt{constructor(e,t,r){super(e,t,tc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ne(this.firestore,null,new M(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function bf(n,e,...t){if(n=fe(n),Af("collection","path",e),n instanceof In){let r=ne.fromString(e,...t);return bd(r),new vt(n,null,r)}{if(!(n instanceof Ne||n instanceof vt))throw new F(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return bd(r),new vt(n.firestore,null,r)}}function Sf(n,e,...t){if(n=fe(n),arguments.length===1&&(e=Mi.newId()),Af("doc","path",e),n instanceof In){let r=ne.fromString(e,...t);return Dd(r),new Ne(n,null,new M(r))}{if(!(n instanceof Ne||n instanceof vt))throw new F(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return Dd(r),new Ne(n.firestore,n instanceof vt?n.converter:null,new M(r))}}var ss=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ji(this,"async_queue_retry"),this.Vu=()=>{let r=la();r&&x("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;let t=la();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=la();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new et;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return D(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Fr(e))throw e;x("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;let i=function(a){let c=a.message||"";return a.stack&&(c=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),c}(r);throw nt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=bu.createAndSchedule(this,e,t,r,o=>this.yu(o));return this.Tu.push(i),i}fu(){this.Eu&&U()}verifyOperationInProgress(){}wu(){return D(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function Sd(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1}(n,["next","error","complete"])}var Tn=class extends In{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new ss,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return D(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ss(e),this._firestoreClient=void 0,yield e}})}};function Cf(n,e){let t=typeof n=="object"?n:nr(),r=typeof n=="string"?n:e||"(default)",i=Mo(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=ih("firestore");o&&Df(i,...o)}return i}function hc(n){if(n._terminated)throw new F(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Wv(n),n._firestoreClient}function Wv(n){var e,t,r;let i=n._freezeSettings(),o=function(c,h,d,p){return new Ia(c,h,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Tf(p.experimentalLongPollingOptions),p.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Mu(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(c){let h=c?._online.build();return{_offline:c?._offline.build(h),_online:h}}(n._componentsProvider))}var Cr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ie.fromBase64String(e))}catch(t){throw new F(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var An=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new F(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Rr=class{constructor(e){this._methodName=e}};var Pr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}};var Nr=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}};var Kv=/^__.*__$/,Vu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ge(e,this.data,this.fieldMask,t,this.fieldTransforms):new zt(e,this.data,t,this.fieldTransforms)}},os=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ge(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Rf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var Uu=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.vu(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return us(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Rf(this.Cu)&&Kv.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Bu=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||gs(e)}Qu(e,t,r,i=!1){return new Uu({Cu:e,methodName:t,qu:r,path:Pe.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Pf(n){let e=n._freezeSettings(),t=gs(n._databaseId);return new Bu(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Hv(n,e,t,r,i,o={}){let a=n.Qu(o.merge||o.mergeFields?2:0,e,t,i);dc("Data must be an object, but it was:",a,r);let c=Nf(r,a),h,d;if(o.merge)h=new Fe(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){let p=[];for(let v of o.mergeFields){let A=$u(e,v,t);if(!a.contains(A))throw new F(C.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);Of(p,A)||p.push(A)}h=new Fe(p),d=a.fieldTransforms.filter(v=>h.covers(v.field))}else h=null,d=a.fieldTransforms;return new Vu(new Re(c),h,d)}var as=class n extends Rr{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function Qv(n,e,t,r){let i=n.Qu(1,e,t);dc("Data must be an object, but it was:",i,r);let o=[],a=Re.empty();Gt(r,(h,d)=>{let p=fc(e,h,t);d=fe(d);let v=i.Nu(p);if(d instanceof as)o.push(p);else{let A=Mr(d,v);A!=null&&(o.push(p),a.set(p,A))}});let c=new Fe(o);return new os(a,c,i.fieldTransforms)}function Yv(n,e,t,r,i,o){let a=n.Qu(1,e,t),c=[$u(e,r,t)],h=[i];if(o.length%2!=0)throw new F(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let A=0;A<o.length;A+=2)c.push($u(e,o[A])),h.push(o[A+1]);let d=[],p=Re.empty();for(let A=c.length-1;A>=0;--A)if(!Of(d,c[A])){let S=c[A],k=h[A];k=fe(k);let P=a.Nu(S);if(k instanceof as)d.push(S);else{let R=Mr(k,P);R!=null&&(d.push(S),p.set(S,R))}}let v=new Fe(d);return new os(p,v,a.fieldTransforms)}function Jv(n,e,t,r=!1){return Mr(t,n.Qu(r?4:3,e))}function Mr(n,e){if(kf(n=fe(n)))return dc("Unsupported field value:",e,n),Nf(n,e);if(n instanceof Rr)return function(r,i){if(!Rf(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){let o=[],a=0;for(let c of r){let h=Mr(c,i.Lu(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=fe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return F_(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=pe.fromDate(r);return{timestampValue:Ki(i.serializer,o)}}if(r instanceof pe){let o=new pe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ki(i.serializer,o)}}if(r instanceof Pr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Cr)return{bytesValue:ef(i.serializer,r._byteString)};if(r instanceof Ne){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:rc(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Nr)return function(a,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw c.Bu("VectorValues must only contain numeric values.");return nc(c.serializer,h)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${vs(r)}`)}(n,e)}function Nf(n,e){let t={};return Nd(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gt(n,(r,i)=>{let o=Mr(i,e.Mu(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function kf(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof pe||n instanceof Pr||n instanceof Cr||n instanceof Ne||n instanceof Rr||n instanceof Nr)}function dc(n,e,t){if(!kf(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=vs(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function $u(n,e,t){if((e=fe(e))instanceof An)return e._internalPath;if(typeof e=="string")return fc(n,e);throw us("Field path arguments must be of type string or ",n,!1,void 0,t)}var Xv=new RegExp("[~\\*/\\[\\]]");function fc(n,e,t){if(e.search(Xv)>=0)throw us(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new An(...e.split("."))._internalPath}catch{throw us(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function us(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new F(C.INVALID_ARGUMENT,c+n+h)}function Of(n,e){return n.some(t=>t.isEqual(e))}var cs=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ne(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new ju(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(pc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},ju=class extends cs{data(){return super.data()}};function pc(n,e){return typeof e=="string"?fc(n,e):e instanceof An?e._internalPath:e._delegate._internalPath}function Zv(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new F(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var kr=class{},ls=class extends kr{};function Ff(n,e,...t){let r=[];e instanceof kr&&r.push(e),r=r.concat(t),function(o){let a=o.filter(h=>h instanceof qu).length,c=o.filter(h=>h instanceof zu).length;if(a>1||a>0&&c>0)throw new F(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var zu=class n extends ls{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Lf(e._query,t),new qt(e.firestore,e.converter,xa(e._query,t))}_parse(e){let t=Pf(e.firestore);return function(o,a,c,h,d,p,v){let A;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new F(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Rd(v,p);let S=[];for(let k of v)S.push(Cd(h,o,k));A={arrayValue:{values:S}}}else A=Cd(h,o,v)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Rd(v,p),A=Jv(c,a,v,p==="in"||p==="not-in");return ue.create(d,p,A)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};var qu=class n extends kr{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ve.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,o){let a=i,c=o.getFlattenedFilters();for(let h of c)Lf(a,h),a=xa(a,h)}(e._query,t),new qt(e.firestore,e.converter,xa(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Gu=class n extends ls{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,o,a){if(i.startAt!==null)throw new F(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new F(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Bt(o,a)}(e._query,this._field,this._direction);return new qt(e.firestore,e.converter,function(i,o){let a=i.explicitOrderBy.concat([o]);return new wt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function xf(n,e="asc"){let t=e,r=pc("orderBy",n);return Gu._create(r,t)}function Cd(n,e,t){if(typeof(t=fe(t))=="string"){if(t==="")throw new F(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bd(e)&&t.indexOf("/")!==-1)throw new F(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ne.fromString(t));if(!M.isDocumentKey(r))throw new F(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Xh(n,new M(r))}if(t instanceof Ne)return Xh(n,t._key);throw new F(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vs(t)}.`)}function Rd(n,e){if(!Array.isArray(n)||n.length===0)throw new F(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Lf(n,e){let t=function(i,o){for(let a of i)for(let c of a.getFlattenedFilters())if(o.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new F(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new F(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Wu=class{convertValue(e,t="none"){switch(Ut(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Et(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Gt(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;let o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>ee(a.doubleValue));return new Nr(o)}convertGeoPoint(e){return new Pr(ee(e.latitude),ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Ju(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(wr(e));default:return null}}convertTimestamp(e){let t=rt(e);return new pe(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ne.fromString(e);J(af(r));let i=new $i(r.get(1),r.get(3)),o=new M(r.popFirst(5));return i.isEqual(t)||nt(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function eE(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Lt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},hs=class extends cs{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(pc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},hn=class extends hs{data(e={}){return super.data(e)}},Ku=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Lt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new hn(this._firestore,this._userDataWriter,r.key,r,new Lt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(c=>{let h=new hn(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Lt(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>o||c.type!==3).map(c=>{let h=new hn(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Lt(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),p=a.indexOf(c.doc.key)),{type:tE(c.type),doc:h,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function tE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}var ds=class extends Wu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ne(this.firestore,null,t)}};function mc(n,...e){var t,r,i;n=fe(n);let o={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Sd(e[a])||(o=e[a],a++);let c={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Sd(e[a])){let v=e[a];e[a]=(t=v.next)===null||t===void 0?void 0:t.bind(v),e[a+1]=(r=v.error)===null||r===void 0?void 0:r.bind(v),e[a+2]=(i=v.complete)===null||i===void 0?void 0:i.bind(v)}let h,d,p;if(n instanceof Ne)d=vr(n.firestore,Tn),p=tc(n._key.path),h={next:v=>{e[a]&&e[a](rE(d,n,v))},error:e[a+1],complete:e[a+2]};else{let v=vr(n,qt);d=vr(v.firestore,Tn),p=v._query;let A=new ds(d);h={next:S=>{e[a]&&e[a](new Ku(d,A,v,S))},error:e[a+1],complete:e[a+2]},Zv(n._query)}return function(A,S,k,P){let R=new Lu(P),V=new Pu(S,R,k);return A.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return Dv(yield Td(A),V)})),()=>{R.Za(),A.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return bv(yield Td(A),V)}))}}(hc(d),p,c,h)}function nE(n,e){return function(r,i){let o=new et;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return Fv(yield qv(r),i,o)})),o.promise}(hc(n),e)}function rE(n,e,t){let r=t.docs.get(e._key),i=new ds(n);return new hs(n,i,e._key,r,new Lt(t.hasPendingWrites,t.fromCache),e.converter)}var Hu=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Pf(e)}set(e,t,r){this._verifyNotCommitted();let i=da(e,this._firestore),o=eE(i.converter,t,r),a=Hv(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,tt.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let o=da(e,this._firestore),a;return a=typeof(t=fe(t))=="string"||t instanceof An?Yv(this._dataReader,"WriteBatch.update",o._key,t,r,i):Qv(this._dataReader,"WriteBatch.update",o._key,t),this._mutations.push(a.toMutation(o._key,tt.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=da(e,this._firestore);return this._mutations=this._mutations.concat(new Tr(t._key,tt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new F(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function da(n,e){if((n=fe(n)).firestore!==e)throw new F(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function Mf(n){return hc(n=vr(n,Tn)),new Hu(n,e=>nE(n,e))}(function(e,t=!0){(function(i){Dn=i})(tn),gt(new Oe("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),c=new Tn(new ma(r.getProvider("auth-internal")),new va(r.getProvider("app-check-internal")),function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new F(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $i(d.options.projectId,p)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),c._setSettings(o),c},"PUBLIC").setMultipleInstances(!0)),le(Hh,"4.7.3",e),le(Hh,"4.7.3","esm2017")})();var Es=function(){return Es=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Es.apply(this,arguments)};var oE={includeMetadataChanges:!1};function Vf(n,e){return e===void 0&&(e=oE),new ct(function(t){var r=mc(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function Uf(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Es(Es({},r),(t={},t[e.idField]=n.id,t))}function Bf(n){return Vf(n,{includeMetadataChanges:!0}).pipe(De(function(e){return e.docs}))}function $f(n,e){return e===void 0&&(e={}),Bf(n).pipe(De(function(t){return t.map(function(r){return Uf(r,e)})}))}var Kt=class{constructor(e){return e}},jf="firestore",gc=class{constructor(){return ir(jf)}};var yc=new be("angularfire2.firestore-instances");function aE(n,e){let t=Bo(jf,n,e);return t&&new Kt(t)}function uE(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Kt(r)}}var cE={provide:gc,deps:[[new lt,yc]]},lE={provide:Kt,useFactory:aE,deps:[[new lt,yc],Nt]};function uA(n,...e){return le("angularfire",rn.full,"fst"),Xt([lE,cE,{provide:yc,useFactory:uE(n),multi:!0,deps:[Qe,Kn,sr,or,[new lt,Ri],[new lt,rr],...e]}])}var _c=Le($f,!0);var vc=Le(bf,!0);var Ec=Le(Sf,!0);var cA=Le(Cf,!0);var zf=Le(xf,!0);var wc=Le(Ff,!0);var Ic=Le(Mf,!0);var ws=class n{firestore=se(Kt);http=se(mo);catsDataUrl="https://conseil.latelier.co/data/cats.json";catsCollection=vc(this.firestore,"cats");appearancesCollection=vc(this.firestore,"cat_appearances");fetchCatsData$(){return this.http.get(this.catsDataUrl).pipe(De(e=>e.images),ri(()=>ti(()=>"An error occurred while fetching cats data from the remote source.")))}fetchPersistedCats$(){let e=wc(this.catsCollection);return _c(e).pipe(eo(t=>!!t),ri(()=>ti(()=>new Error("An error occurred while fetching persisted cats."))))}fetchCatAppearances$(){let e=wc(this.appearancesCollection,zf("appearedAt","desc"));return _c(e).pipe(eo(t=>!!t),ri(()=>ti(()=>new Error("An error occurred while fetching cat last appearances."))))}fetchCats$(){return ni([this.fetchCatsData$(),this.fetchPersistedCats$()]).pipe(De(([e,t])=>this.mergeCats(e,t)))}mergeCats(e,t){return e.map(r=>{let i=t.find(o=>o.id===r.id);return i||{id:r.id,imageUrl:r.url,score:0,appearances:0}})}updateCats(e){return D(this,null,function*(){let t=Ic(this.firestore);e.forEach(r=>{let i=Ec(this.catsCollection,r.id);t.set(i,r)}),yield t.commit()})}updateCatAppearances(e){return D(this,null,function*(){let t=Ic(this.firestore);e.forEach(r=>{let i=Ec(this.appearancesCollection,r.catId);t.set(i,r)}),yield t.commit()})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var qf=class n{MAX_RECENT_HISTORY=8;catStorage=se(ws);getCatRanking$(){return this.catStorage.fetchCats$().pipe(De(e=>e.sort((t,r)=>r.score===t.score?t.appearances-r.appearances:r.score-t.score)))}selectCatOpponents$(){return ni([this.catStorage.fetchCats$(),this.catStorage.fetchCatAppearances$()]).pipe(De(([e,t])=>this.selectCatOpponents(e,t)))}selectCatOpponents(e,t){let r=this.getUnseenCats(e,t),i=this.getLeastAppeared(r);if(i.length<2){let o=r[Math.floor(Math.random()*r.length)];return[i[0],o]}return i.sort(()=>Math.random()-.5),[i[0],i[1]]}getUnseenCats(e,t){let r=t.slice(0,this.MAX_RECENT_HISTORY);return e.filter(i=>!r.some(o=>o.catId===i.id))}getLeastAppeared(e){let t=Math.min(...e.map(r=>r.appearances));return e.filter(r=>r.appearances===t)}recordVote(r){return D(this,arguments,function*({winner:e,loser:t}){try{e.score+=1,e.appearances+=1,t.appearances+=1,yield this.catStorage.updateCats([e,t]);let i=[{catId:e.id,appearedAt:new Date().toISOString()},{catId:t.id,appearedAt:new Date().toISOString()}];yield this.catStorage.updateCatAppearances(i)}catch(i){throw console.error("Error recording vote:",i),new Error("Failed to register the vote. Please try again later.")}})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};export{oo as a,QE as b,Ll as c,ai as d,Fp as e,zl as f,YE as g,JE as h,XE as i,Bp as j,si as k,pw as l,rI as m,iI as n,uA as o,cA as p,qf as q};
